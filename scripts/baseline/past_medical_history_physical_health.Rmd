---
title: "Past medical history (covid cns)"
author: "Chelsea Mika Malouf"
date: "14/01/2022"
output: html_document
---

This script is to go over past medical history and consists of questions from "Physical Health History" and "Mental Health History".The script combines the 2 datasets.
They consist of the following overall questions:
Have you ever been diagnosed with the following nervous system illnesses? 
Have you ever been diagnosed with any allergies? 
Have you ever been diagnosed with any bone or joint illnesses? 
Have you ever been diagnosed with the following lung, breathing or respiratory illnesses?
Have you ever been diagnosed with heart or circulation illnesses? 
Have you ever been diagnosed with the following cancers? 
Have you ever been diagnosed with the following illnesses? 
Have you ever been diagnosed with digestive problem or diabetes? 

Please note that there are a lot of missing variables in this set that are included in the Qualtrics survey due to the natural language extraction issue.
There were no miscoded variables and the variable issue has been noted to Topher and Leo.


#Set up 
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
)
```

```{r Delete everything in your global environment}
remove(list = ls())
```

```{r Read in functions}
source(file = "../functions/remove_duplicates.R")
source(file = "../functions/sumscores.R")
source(file = "../functions/package_check.R")
source(file = "../functions/imp_check.R")
source(file = "../functions/add_numeric.R")
```

```{r Install load dependencies}
packages <- c("summarytools",
              "sjlabelled",
              "Amelia",
              "gtsummary",
              "tidyverse")
package_check(packages)
```

```{r Recent date}
date <- Sys.Date()
date
```

```{r Read in file with path to ilovedata channel on teams}
source(file = "../../credentials/paths.R")
```

## Read in Physical Health History covid cns data
```{r Covid cns load data PHH} 
phh_dat <- read_rds(
  file = paste0(ilovedata, "/data_raw/latest_freeze/covid_cns/baseline/phh_covid_cns.rds")
  )
  
# Check variable names in dataframe
phh_dat %>%
  colnames()

# Inspect dimensions of dataframe 
phh_dat %>%
  dim()
```

```{r CNS specify excluded columns}
exclude_cols_numeric <- c(
  "ID",
  "sample",
  "startDate",
  "endDate",
  "phh.drug_allergy_text.txt",
  "phh.food_allergy_text.txt",
  "phh.allergy_text.txt",
  "phh.other_arthritistext.txt",
  "phh.othertext.txt",
  "phh.thyroid_diseasetext.txt"
  )
```

```{r CNS select}
phh_dat_id <- phh_dat %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop participants with no ID
  remove_duplicates("externalDataReference") %>% # Remove duplicate IDs
  add_column(sample = "CNS",
             .after = "externalDataReference") %>% # Create new sample column
  select(
         ID = externalDataReference, # ID
         sample,
         startDate,
         endDate,
         phh.epilepsy_or_convulsions,
         phh.migraines	,
         phh.multiple_sclerosis,
         phh.parkinsons_disease,
         phh.severe_memory_loss_,
         phh.hay_fever,
         phh.drug_allergy,
         phh.food_allergy_,
         phh.any_other_allergy_,
         phh.dont_know,
         phh.prefer_not_to_answer,
         phh.none_of_the_above,
         phh.osteoporosis,
         phh.osteoarthritis,
         phh.rheumatoid_arthritis,
         phh.other_arthritis,
         phh.none_of_the_above.1,
         phh.asthma,
         phh.pulmonary_fibrosis,
         phh.chronic_obstructive_pulmonary_disease_,
         phh.cystic_fibrosis,
         phh.pleural_effusion,
         phh.pneumonia_,
         phh.pulmonary_embolus_,
         phh.emphysema_or_chronic_bronchitis,
         phh.other,
         phh.dont_know.1,
         phh.prefer_not_to_say,
         phh.none_of_the_above.2,
         phh.heart_attackangina,
         phh.high_blood_cholesterol,
         phh.high_blood_pressure,
         phh.atrial_fibrillation,
         phh.stroke,
         phh.breast_cancer,
         phh.lung_cancer,
         phh.stomach_cancer,
         phh.colon_cancer,
         phh.uterus_cancer,
         phh.prostate_cancer,
         phh.none,
         phh.dont_know.2,
         phh.prefer_not_to_say.1,
         phh.psoriasis,
         phh.vitiligo,
         phh.eczema,
         phh.thyroid_disease,
         phh.none.1,
         phh.dont_know.3,
         phh.prefer_not_to_say.2,
         phh.crohns_disease,
         phh.ulcerative_colitis,
         phh.irritable_bowel_disease_,
         phh.coeliac_disease,
         phh.bacterial_stomach_infection_,
         phh.viral_weeks_bacterial_stomach,
         phh.diabetes_type_1_,
         phh.diabetes_type_2_,
         phh.pain_due_to_diabetes_,
         phh.prefer_not_to_answer.20,
         phh.drug_allergy_text.txt,
         phh.food_allergy_text.txt,
         phh.allergy_text.txt,
         phh.other_arthritistext.txt,
         phh.othertext.txt,
         phh.thyroid_diseasetext.txt 
         #phh.dont_know.25	,
         #phh.none_of_the_above.24
         #phh.prefer_not_to_answer.1
         ) %>%
  add_numeric(exclude = exclude_cols_numeric)

# Inspect colnames
phh_dat_id %>%
  colnames()
```

```{r cns number excluded}
# Inspect dimensions of new data set
phh_dat_id %>%
  dim()

# Inspect number of rows dropped
phh_excluded <- dim(phh_dat_id)[1] - dim(phh_dat)[1]
phh_excluded
```

```{r inspect numeric variables}
phh_dat_id %>%
  select(all_of(ends_with("numeric"))) %>%
  tbl_summary(missing_text = "Missing")
```

```{r inspect missingness}
miss_map <- phh_dat_id %>% 
  missmap()

miss_map
```

```{r Recode NA values}
dat <- phh_dat_id %>%
   mutate(across(ends_with("numeric"),
                 ~case_when(
                   . == -55 ~ -555,
                   . == -77 ~ -777,
                   . == -88 ~ -888,
                   . == -99 ~ -999,
                   TRUE ~ .)))

```


# Cleaning Categorical variables (Nervous system illness)
```{r vector categorical values phh.epilepsy_or_convulsions}
values_categorical_epilepsy <- c(
  "Epilepsy or convulsions",
  "Not Epilepsy or convulsions", 
  NA
  )
values_categorical_epilepsy

```

```{r vector categorical variables phh.epilepsy_or_convulsions}
variables_categorical_epilepsy <-
  c(
    "phh.epilepsy_or_convulsions"
    )
variables_categorical_epilepsy
```

```{r imp_check categorical variables phh.epilepsy_or_convulsions}
imp_check(data = dat,
          variables = variables_categorical_epilepsy,
          values = values_categorical_epilepsy)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.migraines}
values_categorical_migraine <- 
  c(
  "Not Migraines",
  "Migraines",
  NA
  )
values_categorical_migraine
```

```{r vector categorical variables phh.migraines}
variables_categorical_migraine <-
  c(
    "phh.migraines"
    )
variables_categorical_migraine
```

```{r imp_check categorical variables phh.migraines}
imp_check(data = dat,
          variables = variables_categorical_migraine,
          values = values_categorical_migraine)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.multiple_sclerosis}
values_categorical_ms <- 
  c(
    "Not Multiple sclerosis",
    "Multiple sclerosis",
    NA
  )
values_categorical_ms
```

```{r vector categorical variables phh.multiple_sclerosis}
variables_categorical_ms <-
  c(
    "phh.multiple_sclerosis"
    )
variables_categorical_ms
```

```{r imp_check categorical variables phh.multiple_sclerosis}
imp_check(data = dat,
          variables = variables_categorical_ms,
          values = values_categorical_ms)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.parkinsons_disease}
values_categorical_parkinsons <- 
  c(
    "Not Parkinson's disease",
    "Parkinson's disease",
    NA
  )
values_categorical_parkinsons
```

```{r vector categorical variables phh.parkinsons_disease}
variables_categorical_parkinsons <-
  c(
    "phh.parkinsons_disease"
    )
variables_categorical_parkinsons
```

```{r imp_check categorical variables phh.parkinsons_disease}
imp_check(data = dat,
          variables = variables_categorical_parkinsons,
          values = values_categorical_parkinsons)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


Brain Tumour
phh.brain_tumour not read in correctly from the natural language extract. It says for "Brain Tumour" as age of diagnosis. I have created a request for Leo to look at it


```{r vector categorical values phh.severe_memory_loss_}
values_categorical_severe_memory_loss <- 
  c(
    "Not Severe memory loss (like Alzheimer's)",
    "Severe memory loss (like Alzheimer's)",
    NA
  )
values_categorical_severe_memory_loss
```

```{r vector categorical variables phh.severe_memory_loss_}
variables_categorical_severe_memory_loss <-
  c(
    "phh.severe_memory_loss_"
    )
variables_categorical_severe_memory_loss
```

```{r imp_check categorical variables phh.severe_memory_loss_}
imp_check(data = dat,
          variables = variables_categorical_severe_memory_loss,
          values = values_categorical_severe_memory_loss)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


Cerebral Palsy
phh.cerebral_palsy not read in correctly from the natural language extract. It says for "Cerebral Palsy" as age of diagnosis. I have created a request for Leo to look at it



# Cleaning Categorical variables (Allergies)
```{r vector categorical values phh.hay_fever}
values_categorical_hay_fever <- 
  c(
    "Not Hay fever",
    "Hay fever",
    NA
  )
values_categorical_hay_fever
```

```{r vector categorical variables phh.hay_fever}
variables_categorical_hay_fever <-
  c(
    "phh.hay_fever"
    )
variables_categorical_hay_fever
```

```{r imp_check categorical variables phh.hay_fever}
imp_check(data = dat,
          variables = variables_categorical_hay_fever,
          values = values_categorical_hay_fever)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.drug_allergy}
values_categorical_drug_allergy <- 
  c(
    "Not Drug allergy",
    "Drug allergy",
    NA
  )
values_categorical_drug_allergy
```

```{r vector categorical variables phh.drug_allergy}
variables_categorical_drug_allergy <-
  c(
    "phh.drug_allergy"
    )
variables_categorical_drug_allergy
```

```{r imp_check categorical variables phh.drug_allergy}
imp_check(data = dat,
          variables = variables_categorical_drug_allergy,
          values = values_categorical_drug_allergy)
#The number of implausible values in the dataset is 165. Please investigate. Need to recode variable
```

#Recode names to make shorter. Remove once fixed on Qualtrics if possible
++ Mika Malouf messaged Dina Monssen to change the variables in Qualtrics. 
```{r unify all labels}
dat <- dat %>%  
  mutate(phh.drug_allergy = 
           fct_recode(phh.drug_allergy,
    "Not Drug allergy" = "Not Drug allergy (if yes, please put which drug?):",
    "Drug allergy" = "Drug allergy (if yes, please put which drug?):")
  )
```

Check that corrections applied
```{r imp_check categorical variables phh.drug_allergy}
imp_check(data = dat,
          variables = variables_categorical_drug_allergy,
          values = values_categorical_drug_allergy)
#The number of implausible values in the dataset is 165. Please investigate. Need to recode variable
```


```{r vector categorical values phh.food_allergy_}
values_categorical_food_allergy <- 
  c(
    "Not Food allergy",
    "Food allergy",
    NA
  )
values_categorical_food_allergy
```

```{r vector categorical variables phh.food_allergy_}
variables_categorical_food_allergy <-
  c(
    "phh.food_allergy_"
    )
variables_categorical_food_allergy
```

```{r imp_check categorical variables phh.food_allergy_}
imp_check(data = dat,
          variables = variables_categorical_food_allergy,
          values = values_categorical_food_allergy)
#The number of implausible values in the dataset is 165. Please investigate.
```

#Recode names to make shorter. Remove once fixed on Qualtrics if possible
++ Mika Malouf messaged Dina Monssen to change the variables in Qualtrics
```{r recode food allergy}
dat <- dat %>%  
  mutate(phh.food_allergy_ = 
           fct_recode(phh.food_allergy_,
    "Not Food allergy" = "Not Food allergy (if yes, please provide detail?):",
    "Food allergy" = "Food allergy (if yes, please provide detail?):")
  )
```

Check to see if corrections applied
```{r imp_check categorical variables phh.food_allergy_}
imp_check(data = dat,
          variables = variables_categorical_food_allergy,
          values = values_categorical_food_allergy)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.any_other_allergy_}
values_categorical_other_allergy <- 
  c(
    "Not Any other allergy",
    "Any other allergy",
    NA
  )
values_categorical_other_allergy
```

```{r vector categorical variables phh.any_other_allergy_}
variables_categorical_other_allergy <-
  c(
    "phh.any_other_allergy_"
    )
variables_categorical_other_allergy
```

```{r imp_check categorical variables phh.any_other_allergy_}
imp_check(data = dat,
          variables = variables_categorical_other_allergy,
          values = values_categorical_other_allergy)
#The number of implausible values in the dataset is 165. Please investigate.
```

#Recode names to make shorter. Remove once fixed on Qualtrics if possible
++ Mika Malouf messaged Dina Monssen to change the variables in Qualtrics
```{r recode other allergy}
dat <- dat %>%  
  mutate(phh.any_other_allergy_ = 
           fct_recode(phh.any_other_allergy_ ,
    "Not Any other allergy" = "Not Any other allergy (if yes, please specify?):",
    "Any other allergy" = "Any other allergy (if yes, please specify?):")
  )
```

Check corrections applied
```{r imp_check categorical variables phh.any_other_allergy_}
imp_check(data = dat,
          variables = variables_categorical_other_allergy,
          values = values_categorical_other_allergy)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.dont_know}
values_categorical_dont_know_allergy <- 
  c(
    "Not Don't know",
    "Don't know",
    NA
  )
values_categorical_dont_know_allergy
```

```{r vector categorical variables phh.dont_know}
variables_categorical_dont_know_allergy <-
  c(
    "phh.dont_know"
    )
variables_categorical_dont_know_allergy
```

```{r imp_check categorical variables phh.dont_know}
imp_check(data = dat,
          variables = variables_categorical_dont_know_allergy,
          values = values_categorical_dont_know_allergy)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.prefer_not_to_answer}
values_categorical_not_answer_allergy <- 
  c(
    "Not Prefer not to answer",
    "Prefer not to answer",
    NA
  )
values_categorical_not_answer_allergy
```

```{r vector categorical variables phh.prefer_not_to_answer}
variables_categorical_not_answer_allergy <-
  c(
    "phh.prefer_not_to_answer"
    )
variables_categorical_not_answer_allergy
```

```{r imp_check categorical variables phh.prefer_not_to_answer}
imp_check(data = dat,
          variables = variables_categorical_not_answer_allergy,
          values = values_categorical_not_answer_allergy)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.none_of_the_above}
values_categorical_none_allergy <- 
  c(
    "Not None of the above",
    "None of the above",
    NA
  )
values_categorical_none_allergy
```

```{r vector categorical variables phh.none_of_the_above}
variables_categorical_none_allergy <-
  c(
    "phh.none_of_the_above"
    )
variables_categorical_none_allergy
```

```{r imp_check categorical variables phh.none_of_the_above}
imp_check(data = dat,
          variables = variables_categorical_none_allergy,
          values = values_categorical_none_allergy)
#There are no implausible values in the dataset. Can leave these variables as they are
```



# Cleaning Categorical variables (digestion problems or diabetes)
```{r vector categorical values phh.crohns_disease}
values_categorical_crohns <- 
  c(
    "Not Crohn's disease",
    "Crohn's disease",
    NA
  )
values_categorical_crohns
```

```{r vector categorical variables phh.crohns_disease}
variables_categorical_crohns <-
  c(
    "phh.crohns_disease"
    )
variables_categorical_crohns
```

```{r imp_check categorical variables phh.crohns_disease}
imp_check(data = dat,
          variables = variables_categorical_crohns,
          values = values_categorical_crohns)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.ulcerative_colitis}
values_categorical_ulterative_colitis <- 
  c(
    "Not Ulcerative colitis",
    "Ulcerative colitis",
    NA
  )
values_categorical_ulterative_colitis
```

```{r vector categorical variables phh.ulcerative_colitis}
variables_categorical_ulcerative_colitis <-
  c(
    "phh.ulcerative_colitis"
    )
variables_categorical_ulcerative_colitis
```

```{r imp_check categorical variables phh.ulcerative_colitis}
imp_check(data = dat,
          variables = variables_categorical_ulcerative_colitis,
          values = values_categorical_ulterative_colitis)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.irritable_bowel_disease_}
values_categorical_ibd <- 
  c(
    "Not Irritable bowel disease (IBD)",
    "Irritable bowel disease (IBD)",
    NA
  )
values_categorical_ibd
```

```{r vector categorical variables phh.irritable_bowel_disease_}
variables_categorical_ibd <-
  c(
    "phh.irritable_bowel_disease_"
    )
variables_categorical_ibd
```

```{r imp_check categorical variables phh.irritable_bowel_disease_}
imp_check(data = dat,
          variables = variables_categorical_ibd,
          values = values_categorical_ibd)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.coeliac_disease}
values_categorical_coeliac <- 
  c(
    "Not Coeliac disease",
    "Coeliac disease",
    NA
  )
values_categorical_coeliac
```

```{r vector categorical variables phh.coeliac_disease}
variables_categorical_coeliac <-
  c(
    "phh.coeliac_disease"
    )
variables_categorical_coeliac
```

```{r imp_check categorical variables phh.coeliac_disease}
imp_check(data = dat,
          variables = variables_categorical_coeliac,
          values = values_categorical_coeliac)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.bacterial_stomach_infection_}
values_categorical_bacterial_stomach <- 
  c(
    "Not Bacterial stomach infection (E.coli or H pylori)",
    "Bacterial stomach infection (E.coli or H pylori)",
    NA
  )
values_categorical_bacterial_stomach
```

```{r vector categorical variables phh.bacterial_stomach_infection_}
variables_categorical_bacterial_stomach <-
  c(
    "phh.bacterial_stomach_infection_"
    )
variables_categorical_bacterial_stomach
```

```{r imp_check categorical variables phh.bacterial_stomach_infection_}
imp_check(data = dat,
          variables = variables_categorical_bacterial_stomach,
          values = values_categorical_bacterial_stomach)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.viral_weeks_bacterial_stomach}
values_categorical_viral_stomach <- 
  c(
    "Not A viral or bacterial stomach infection lasting more than 2 weeks",
    "A viral or bacterial stomach infection lasting more than 2 weeks",
    NA
  )
values_categorical_viral_stomach

```

```{r vector categorical variables phh.viral_weeks_bacterial_stomach}
variables_categorical_viral_stomach <-
  c(
    "phh.viral_weeks_bacterial_stomach"
    )
variables_categorical_viral_stomach
```

```{r imp_check categorical variables phh.viral_weeks_bacterial_stomach}
imp_check(data = dat,
          variables = variables_categorical_viral_stomach,
          values = values_categorical_viral_stomach)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.diabetes_type_1_}
values_categorical_diabetes_1 <- 
  c(
    "Not Diabetes type 1 (early onset)",
    "Diabetes type 1 (early onset)",
    NA
  )
values_categorical_diabetes_1
```

```{r vector categorical variables phh.diabetes_type_1_}
variables_categorical_diabetes_1 <-
  c(
    "phh.diabetes_type_1_"
    )
variables_categorical_diabetes_1
```

```{r imp_check categorical variables phh.diabetes_type_1_}
imp_check(data = dat,
          variables = variables_categorical_diabetes_1,
          values = values_categorical_diabetes_1)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.diabetes_type_2_}
values_categorical_diabetes_2 <- 
  c(
    "Not Diabetes type 2 (late onset)",
    "Diabetes type 2 (late onset)",
    NA
  )
values_categorical_diabetes_2
```

```{r vector categorical variables phh.diabetes_type_2_}
variables_categorical_diabetes_2 <-
  c(
    "phh.diabetes_type_2_"
    )
variables_categorical_diabetes_2
```

```{r imp_check categorical variables phh.diabetes_type_2_}
imp_check(data = dat,
          variables = variables_categorical_diabetes_2,
          values = values_categorical_diabetes_2)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.pain_due_to_diabetes_}
values_categorical_pain_diabetes <- 
  c(
    "Not Pain due to diabetes (Diabetic neuropathy)",
    "Pain due to diabetes (Diabetic neuropathy)",
    NA
  )
values_categorical_pain_diabetes
```

```{r vector categorical variables phh.pain_due_to_diabetes_}
variables_categorical_pain_diabetes <-
  c(
    "phh.pain_due_to_diabetes_"
    )
variables_categorical_pain_diabetes
```

```{r imp_check categorical variables phh.pain_due_to_diabetes_}
imp_check(data = dat,
          variables = variables_categorical_pain_diabetes,
          values = values_categorical_pain_diabetes)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.prefer_not_to_answer.20}
values_categorical_not_answer_diabetes_or_digestion <- 
  c(
    "Not Prefer not to answer",
    "Prefer not to answer",
    NA
  )
values_categorical_not_answer_diabetes_or_digestion
```

```{r vector categorical variables phh.prefer_not_to_answer.20}
variables_categorical_not_answer_diabetes_or_digestion <-
  c(
    "phh.prefer_not_to_answer.20"
    )
variables_categorical_not_answer_diabetes_or_digestion
```

```{r imp_check categorical variables phh.prefer_not_to_answer.20}
imp_check(data = dat,
          variables = variables_categorical_not_answer_diabetes_or_digestion,
          values = values_categorical_not_answer_diabetes_or_digestion)
#There are no implausible values in the dataset. Can leave these variables as they are
```


++CMM The following variables are not included in the script for this section but should be because it is hidden on Qualtrics. Messaged Dina Monssen to fix it.
  Dont know
  None of the above




# Cleaning Categorical variables (Bone or joint illness)
```{r vector categorical values phh.osteoporosis}
values_categorical_osteoperosis <- 
  c(
    "Not Osteoporosis",
    "Osteoporosis",
    NA
  )
values_categorical_osteoperosis
```

```{r vector categorical variables phh.osteoporosis}
variables_categorical_osteoperosis <-
  c(
    "phh.osteoporosis"
    )
variables_categorical_osteoperosis
```

```{r imp_check categorical variables phh.osteoporosis}
imp_check(data = dat,
          variables = variables_categorical_osteoperosis,
          values = values_categorical_osteoperosis)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.osteoarthritis}
values_categorical_osteoarthritis <- 
  c(
    "Not Osteoarthritis",
    "Osteoarthritis",
    NA
  )
values_categorical_osteoarthritis
```

```{r vector categorical variables phh.osteoarthritis}
variables_categorical_osteoarthritis <-
  c(
    "phh.osteoarthritis"
    )
variables_categorical_osteoarthritis
```

```{r imp_check categorical variables phh.osteoarthritis}
imp_check(data = dat,
          variables = variables_categorical_osteoarthritis,
          values = values_categorical_osteoarthritis)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.rheumatoid_arthritis}
values_categorical_arthritis <- 
  c(
    "Not Rheumatoid arthritis",
    "Rheumatoid arthritis",
    NA
  )
values_categorical_arthritis
```

```{r vector categorical variables phh.rheumatoid_arthritis}
variables_categorical_arthritis <-
  c(
    "phh.rheumatoid_arthritis"
    )
variables_categorical_arthritis
```

```{r imp_check categorical variables phh.rheumatoid_arthritis}
imp_check(data = dat,
          variables = variables_categorical_arthritis,
          values = values_categorical_arthritis)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.other_arthritis}
values_categorical_other_arthritis <- 
  c(
    "Not Other arthritis",
    "Other arthritis",
    NA
  )
values_categorical_other_arthritis
```

```{r vector categorical variables phh.other_arthritis}
variables_categorical_other_arthritis <-
  c(
    "phh.other_arthritis"
    )
variables_categorical_other_arthritis
```

```{r imp_check categorical variables phh.other_arthritis}
imp_check(data = dat,
          variables = variables_categorical_other_arthritis,
          values = values_categorical_other_arthritis)
#The number of implausible values in the dataset is 152. Need to recode variable
```

```{r Recode variable phh.other_arthritis}
dat <- dat %>%  
  mutate(phh.other_arthritis = 
           fct_recode(phh.other_arthritis,
    "Not Other arthritis" = "Not Other arthritis:",
    "Other arthritis" = "Other arthritis:"
    )
  )
```

```{r imp_check Checking corrections applied phh.other_arthritis}
imp_check(data = dat,
          variables = variables_categorical_other_arthritis,
          values = values_categorical_other_arthritis)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.none_of_the_above.1}
values_categorical_none_bone <- 
  c(
    "Not none of the above",
    "none of the above",
    NA
  )
values_categorical_none_bone
```

```{r vector categorical variables phh.none_of_the_above.1}
variables_categorical_none_bone <-
  c(
    "phh.none_of_the_above.1"
    )
variables_categorical_none_bone
```

```{r imp_check categorical variables phh.none_of_the_above.1}
imp_check(data = dat,
          variables = variables_categorical_none_bone,
          values = values_categorical_none_bone)
#There are no implausible values in the dataset. Can leave these variables as they are
```

++Response "Dont know" is hidden on Qualtrics. Requested Dina Monssen to fix it



# Cleaning Categorical variables (lung illness)
```{r vector categorical values phh.asthma}
values_categorical_asthma <- 
  c(
    "Not Asthma",
    "Asthma",
    NA
  )
values_categorical_asthma
```

```{r vector categorical variables phh.asthma}
variables_categorical_asthma <-
  c(
    "phh.asthma"
    )
variables_categorical_asthma
```

```{r imp_check categorical variables phh.asthma}
imp_check(data = dat,
          variables = variables_categorical_asthma,
          values = values_categorical_asthma)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.pulmonary_fibrosis}
values_categorical_pulmonary_fibrosis <- 
  c(
    "Not Pulmonary fibrosis",
    "Pulmonary fibrosis",
    NA
  )
values_categorical_pulmonary_fibrosis
```

```{r vector categorical variables phh.pulmonary_fibrosis}
variables_categorical_pulmonary_fibrosis <-
  c(
    "phh.pulmonary_fibrosis"
    )
variables_categorical_pulmonary_fibrosis
```

```{r imp_check categorical variables phh.pulmonary_fibrosis}
imp_check(data = dat,
          variables = variables_categorical_pulmonary_fibrosis,
          values = values_categorical_pulmonary_fibrosis)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.chronic_obstructive_pulmonary_disease_}
values_categorical_copd <- 
  c(
    "Not Chronic obstructive pulmonary disease (COPD)",
    "Chronic obstructive pulmonary disease (COPD)",
    NA
  )
values_categorical_copd
```

```{r vector categorical variables phh.chronic_obstructive_pulmonary_disease_}
variables_categorical_copd <-
  c(
    "phh.chronic_obstructive_pulmonary_disease_"
    )
variables_categorical_copd
```

```{r imp_check categorical variables phh.chronic_obstructive_pulmonary_disease_}
imp_check(data = dat,
          variables = variables_categorical_copd,
          values = values_categorical_copd)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.cystic_fibrosis}
values_categorical_cystic_fibrosis <- 
  c(
    "Not Cystic fibrosis",
    "Cystic fibrosis",
    NA
  )
values_categorical_cystic_fibrosis
```

```{r vector categorical variables phh.cystic_fibrosis}
variables_categorical_cystic_fibrosis <-
  c(
    "phh.cystic_fibrosis"
    )
variables_categorical_cystic_fibrosis
```

```{r imp_check categorical variables phh.cystic_fibrosis}
imp_check(data = dat,
          variables = variables_categorical_cystic_fibrosis,
          values = values_categorical_cystic_fibrosis)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.pleural_effusion}
values_categorical_pleural_effusion <- 
  c(
    "Not Pleural effusion",
    "Pleural effusion",
    NA
  )
values_categorical_pleural_effusion
```

```{r vector categorical variables phh.pleural_effusion}
variables_categorical_pleural_effusion <-
  c(
    "phh.pleural_effusion"
    )
variables_categorical_pleural_effusion
```

```{r imp_check categorical variables phh.pleural_effusion}
imp_check(data = dat,
          variables = variables_categorical_pleural_effusion,
          values = values_categorical_pleural_effusion)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.pneumonia_}
values_categorical_pneumonia <- 
  c(
    "Not Pneumonia (lung infection)",
    "Pneumonia (lung infection)",
    NA
  )
values_categorical_pneumonia
```

```{r vector categorical variables phh.pneumonia_}
variables_categorical_pneumonia <-
  c(
    "phh.pneumonia_"
    )
variables_categorical_pneumonia
```

```{r imp_check categorical variables phh.pneumonia_}
imp_check(data = dat,
          variables = variables_categorical_pneumonia,
          values = values_categorical_pneumonia)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.pulmonary_embolus_}
values_categorical_pulmonary_embolus <- 
  c(
    "Not Pulmonary embolus (blocked lung artery)",
    "Pulmonary embolus (blocked lung artery)",
    NA
  )
values_categorical_pulmonary_embolus
```

```{r vector categorical variables phh.pulmonary_embolus_}
variables_categorical_pulmonary_embolus <-
  c(
    "phh.pulmonary_embolus_"
    )
variables_categorical_pulmonary_embolus
```

```{r imp_check categorical variables phh.pulmonary_embolus_}
imp_check(data = dat,
          variables = variables_categorical_pulmonary_embolus,
          values = values_categorical_pulmonary_embolus)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.emphysema_or_chronic_bronchitis}
values_categorical_bronchitis <- 
  c(
    "Not Emphysema or chronic bronchitis",
    "Emphysema or chronic bronchitis",
    NA
  )
values_categorical_bronchitis
```

```{r vector categorical variables phh.emphysema_or_chronic_bronchitis}
variables_categorical_bronchitis <-
  c(
    "phh.emphysema_or_chronic_bronchitis"
    )
variables_categorical_bronchitis
```

```{r imp_check categorical variables phh.emphysema_or_chronic_bronchitis}
imp_check(data = dat,
          variables = variables_categorical_bronchitis,
          values = values_categorical_bronchitis)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.other}
values_categorical_other_lung <- 
  c(
    "Not Other",
    "Other",
    NA
  )
values_categorical_other_lung
```

```{r vector categorical variables phh.other}
variables_categorical_other_lung <-
  c(
    "phh.other"
    )
variables_categorical_other_lung
```

```{r imp_check categorical variables phh.other}
imp_check(data = dat,
          variables = variables_categorical_other_lung,
          values = values_categorical_other_lung)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.dont_know.1}
values_categorical_dont_know_lung <- 
  c(
    "Not Don't know",
    "Don't know",
    NA
  )
values_categorical_dont_know_lung
```

```{r vector categorical variables phh.dont_know.1}
variables_categorical_dont_know_lung <-
  c(
    "phh.dont_know.1"
    )
variables_categorical_dont_know_lung
```

```{r imp_check categorical variables phh.dont_know.1}
imp_check(data = dat,
          variables = variables_categorical_dont_know_lung,
          values = values_categorical_dont_know_lung)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.prefer_not_to_say} 
values_categorical_not_say_lung <- 
  c(
    "Not Prefer not to say",
    "Prefer not to say",
    NA
 ) 
values_categorical_not_say_lung 
``` 

```{r vector categorical variables phh.prefer_not_to_say} 
variables_categorical_not_say_lung <- 
  c( 
    "phh.prefer_not_to_say" 
     ) 
variables_categorical_not_say_lung 
``` 

```{r imp_check categorical variables phh.prefer_not_to_say} 
imp_check(data = dat, 
         variables = variables_categorical_not_say_lung, 
         values = values_categorical_not_say_lung) 
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.none_of_the_above.2} 
values_categorical_none_lung <- 
  c( 
    "Not None of the above",
    "None of the above",
    NA
    ) 
values_categorical_none_lung 
```

```{r vector categorical variables phh.none_of_the_above.2} 
variables_categorical_none_lung <- 
  c( 
    "phh.none_of_the_above.2" 
     ) 
 variables_categorical_none_lung 
```

```{r imp_check categorical variables phh.none_of_the_above.2}
imp_check(data = dat,
           variables = variables_categorical_none_lung,
           values = values_categorical_none_lung)
#There are no implausible values in the dataset. Can leave these variables as they are.
```



# Cleaning Categorical variables (Heart or circulation illness)
```{r vector categorical values phh.heart_attackangina}
values_categorical_heart_attack <- 
  c(
    "Not Heart attack/angina",
    "Heart attack/angina",
    NA
  )
values_categorical_heart_attack
```

```{r vector categorical variables phh.heart_attackangina}
variables_categorical_heart_attack <-
  c(
    "phh.heart_attackangina"
    )
variables_categorical_heart_attack
```

```{r imp_check categorical variables phh.heart_attackangina}
imp_check(data = dat,
          variables = variables_categorical_heart_attack,
          values = values_categorical_heart_attack)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.high_blood_cholesterol}
values_categorical_cholesterol <- 
  c(
    "Not High blood cholesterol",
    "High blood cholesterol",
    NA
  )
values_categorical_cholesterol
```

```{r vector categorical variables phh.high_blood_cholesterol}
variables_categorical_cholesterol <-
  c(
    "phh.high_blood_cholesterol"
    )
variables_categorical_cholesterol
```

```{r imp_check categorical variables phh.high_blood_cholesterol}
imp_check(data = dat,
          variables = variables_categorical_cholesterol,
          values = values_categorical_cholesterol)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.high_blood_pressure}
values_categorical_blood_pressure <- 
  c(
    "Not High blood pressure",
    "High blood pressure",
    NA
  )
values_categorical_blood_pressure
```

```{r vector categorical variables phh.high_blood_pressure}
variables_categorical_blood_pressure <-
  c(
    "phh.high_blood_pressure"
    )
variables_categorical_blood_pressure
```

```{r imp_check categorical variables phh.high_blood_pressure}
imp_check(data = dat,
          variables = variables_categorical_blood_pressure,
          values = values_categorical_blood_pressure)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.atrial_fibrillation}
values_categorical_atrial_fib <- 
  c(
    "Not Atrial fibrillation",
    "Atrial fibrillation",
    NA
  )
values_categorical_atrial_fib
```

```{r vector categorical variables phh.atrial_fibrillation}
variables_categorical_atrial_fib <-
  c(
    "phh.atrial_fibrillation"
    )
variables_categorical_atrial_fib
```

```{r imp_check categorical variables phh.atrial_fibrillation}
imp_check(data = dat,
          variables = variables_categorical_atrial_fib,
          values = values_categorical_atrial_fib)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.stroke}
values_categorical_stroke <- 
  c(
    "Not Stroke",
    "Stroke",
    NA
  )
values_categorical_stroke
```

```{r vector categorical variables phh.stroke}
variables_categorical_stroke <-
  c(
    "phh.stroke"
    )
variables_categorical_stroke
```

```{r imp_check categorical variables phh.stroke}
imp_check(data = dat,
          variables = variables_categorical_stroke,
          values = values_categorical_stroke
          )
#There are no implausible values in the dataset. Can leave these variables as they are.
```

++CMM The following variables are not shown due to natural language extraction issues. These variables will be added to the script when the issue is fixed.
  Paroxysmal trachial syndrome (PoTS)
  Dont know
  Prefer not to answer
  None of the above



# Cleaning Categorical variables (Cancer)
```{r vector categorical values phh.breast_cancer}
values_categorical_breast_cancer <- 
  c(
    "Not Breast cancer",
    "Breast cancer",
    NA
  )
values_categorical_breast_cancer
```

```{r vector categorical variables phh.breast_cancer}
variables_categorical_breast_cancer <-
  c(
    "phh.breast_cancer"
    )
variables_categorical_breast_cancer
```

```{r imp_check categorical variables phh.breast_cancer}
imp_check(data = dat,
          variables = variables_categorical_breast_cancer,
          values = values_categorical_breast_cancer)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.lung_cancer}
values_categorical_lung_cancer <- 
  c(
    "Not Lung cancer",
    "Lung cancer",
    NA
  )
values_categorical_lung_cancer
```

```{r vector categorical variables phh.lung_cancer}
variables_categorical_lung_cancer <-
  c(
    "phh.lung_cancer"
    )
variables_categorical_lung_cancer
```

```{r imp_check categorical variables phh.lung_cancer}
imp_check(data = dat,
          variables = variables_categorical_lung_cancer,
          values = values_categorical_lung_cancer)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.stomach_cancer}
values_categorical_stomach_cancer <- 
  c(
    "Not Stomach cancer",
    "Stomach cancer",
    NA
  )
values_categorical_stomach_cancer
```

```{r vector categorical variables phh.stomach_cancer}
variables_categorical_stomach_cancer <-
  c(
    "phh.stomach_cancer"
    )
variables_categorical_stomach_cancer
```

```{r imp_check categorical variables phh.stomach_cancer}
imp_check(data = dat,
          variables = variables_categorical_stomach_cancer,
          values = values_categorical_stomach_cancer)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.colon_cancer}
values_categorical_colon_cancer <- 
  c(
    "Not Colon cancer",
    "Colon cancer",
    NA
  )
values_categorical_colon_cancer
```

```{r vector categorical variables phh.colon_cancer}
variables_categorical_colon_cancer <-
  c(
    "phh.colon_cancer"
    )
variables_categorical_colon_cancer
```

```{r imp_check categorical variables phh.colon_cancer}
imp_check(data = dat,
          variables = variables_categorical_colon_cancer,
          values = values_categorical_colon_cancer)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.uterus_cancer}
values_categorical_uterus_cancer <- 
  c(
    "Not Uterus cancer",
    "Uterus cancer",
    NA
  )
values_categorical_uterus_cancer
```

```{r vector categorical variables phh.uterus_cancer}
variables_categorical_uterus_cancer <-
  c(
    "phh.uterus_cancer"
    )
variables_categorical_uterus_cancer
```

```{r imp_check categorical variables phh.uterus_cancer}
imp_check(data = dat,
          variables = variables_categorical_uterus_cancer,
          values = values_categorical_uterus_cancer)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.prostate_cancer}
values_categorical_prostate_cancer <- 
  c(
    "Not Prostate cancer",
    "Prostate cancer",
    NA
  )
values_categorical_prostate_cancer
```

```{r vector categorical variables phh.prostate_cancer}
variables_categorical_prostate_cancer <-
  c(
    "phh.prostate_cancer"
    )
variables_categorical_prostate_cancer
```

```{r imp_check categorical variables phh.prostate_cancer}
imp_check(data = dat,
          variables = variables_categorical_prostate_cancer,
          values = values_categorical_prostate_cancer)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.none}
values_categorical_none_cancer <- 
  c(
    "Not None",
    "None",
    NA
  )
values_categorical_none_cancer
```

```{r vector categorical variables phh.none}
variables_categorical_none_cancer <-
  c(
    "phh.none"
    )
variables_categorical_none_cancer
```

```{r imp_check categorical variables phh.none}
imp_check(data = dat,
          variables = variables_categorical_none_cancer,
          values = values_categorical_none_cancer)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.dont_know.2}
values_categorical_dont_know_cancer <- 
  c(
    "Not Don't know",
    "Don't know",
    NA
  )
values_categorical_dont_know_cancer
```

```{r vector categorical variables phh.dont_know.2}
variables_categorical_dont_know_cancer <-
  c(
    "phh.dont_know.2"
    )
variables_categorical_dont_know_cancer
```

```{r imp_check categorical variables phh.dont_know.2}
imp_check(data = dat,
          variables = variables_categorical_dont_know_cancer,
          values = values_categorical_dont_know_cancer)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.prefer_not_to_say.1}
values_categorical_not_say_cancer <- 
  c(
    "Not Prefer not to say",
    "Prefer not to say",
    NA
  )
values_categorical_not_say_cancer
```

```{r vector categorical variables phh.prefer_not_to_say.1}
variables_categorical_not_say_cancer <-
  c(
    "phh.prefer_not_to_say.1"
    )
variables_categorical_not_say_cancer
```

```{r imp_check categorical variables phh.prefer_not_to_say.1}
imp_check(data = dat,
          variables = variables_categorical_not_say_cancer,
          values = values_categorical_not_say_cancer)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


++CMM Variables missing from data dictionary that are found on Qualtrics. Informed Leo about the issue
Cancer
Bladder Cancer
Bowel Cancer
Rectal Cancer
Lymphoma
Melanoma
Skin Cancer
Ovarian Cancer




# Cleaning Categorical Variables (chronic illness)
```{r vector categorical values phh.psoriasis}
values_categorical_psoriasis <- 
  c(
    "Not Psoriasis",
    "Psoriasis",
    NA
  )
values_categorical_psoriasis
```

```{r vector categorical variables phh.psoriasis}
variables_categorical_psoriasis <-
  c(
    "phh.psoriasis"
    )
variables_categorical_psoriasis
```

```{r imp_check categorical variables phh.psoriasis}
imp_check(data = dat,
          variables = variables_categorical_psoriasis,
          values = values_categorical_psoriasis)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.vitiligo}
values_categorical_vitiligo <- 
  c(
    "Not Vitiligo",
    "Vitiligo",
    NA
  )
values_categorical_vitiligo
```

```{r vector categorical variables phh.vitiligo}
variables_categorical_vitiligo <-
  c(
    "phh.vitiligo"
    )
variables_categorical_vitiligo
```

```{r imp_check categorical variables phh.vitiligo}
imp_check(data = dat,
          variables = variables_categorical_vitiligo,
          values = values_categorical_vitiligo)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.eczema}
values_categorical_eczema <- 
  c(
    "Not Eczema",
    "Eczema",
    NA
  )
values_categorical_eczema
```

```{r vector categorical variables phh.eczema}
variables_categorical_eczema <-
  c(
    "phh.eczema"
    )
variables_categorical_eczema
```

```{r imp_check categorical variables phh.eczema}
imp_check(data = dat,
          variables = variables_categorical_eczema,
          values = values_categorical_eczema)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.thyroid_disease}
values_categorical_thyroid <- 
  c(
    "Not Thyroid disease",
    "Thyroid disease",
    NA
  )
values_categorical_thyroid
```

```{r vector categorical variables phh.thyroid_disease}
variables_categorical_thyroid <-
  c(
    "phh.thyroid_disease"
    )
variables_categorical_thyroid
```

```{r imp_check categorical variables phh.thyroid_disease} 
imp_check(data = dat,
          variables = variables_categorical_thyroid,
          values = values_categorical_thyroid)
#There are no implausible values in the dataset. Can leave these variables as they are
```


```{r vector categorical values phh.none.1}
values_categorical_none_illness <- 
  c(
    "Not None",
    "None",
    NA
  )
values_categorical_none_illness
```

```{r vector categorical variables phh.none.1}
variables_categorical_none_illness <-
  c(
    "phh.none.1"
    )
variables_categorical_none_illness
```

```{r imp_check categorical variables phh.none.1}
imp_check(data = dat,
          variables = variables_categorical_none_illness,
          values = values_categorical_none_illness)

```


```{r vector categorical values phh.dont_know.3}
values_categorical_dont_know_illness <- 
  c(
    "Not Don't know",
    "Don't know",
    NA
  )
values_categorical_dont_know_illness
```

```{r vector categorical variables phh.dont_know.3}
variables_categorical_dont_know_illness <-
  c(
    "phh.dont_know.3"
    )
variables_categorical_dont_know_illness
```

```{r imp_check categorical variables phh.dont_know.3}
imp_check(data = dat,
          variables = variables_categorical_dont_know_illness,
          values = values_categorical_dont_know_illness)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


```{r vector categorical values phh.prefer_not_to_say.2}
values_categorical_not_say_illness <- 
  c(
    "Not Prefer not to say",
    "Prefer not to say",
    NA
  )
values_categorical_not_say_illness
```

```{r vector categorical variables phh.prefer_not_to_say.2}
variables_categorical_not_say_illness <-
  c(
    "phh.prefer_not_to_say.2"
    )
variables_categorical_not_say_illness
```

```{r imp_check categorical variables phh.prefer_not_to_say.2}
imp_check(data = dat,
          variables = variables_categorical_not_say_illness,
          values = values_categorical_not_say_illness)
#There are no implausible values in the dataset. Can leave these variables as they are
```




# Numeric variables
```{r vector numeric values}
values_numeric_0_1 <- 
  c(
    NA,
    0,
    1,
    -777
  )
values_numeric_0_1
```

```{r vector numeric variables}
dat %>%
  freq(phh.drug_allergy_numeric)
variables_numeric_0_1 <-
  c(
         "phh.epilepsy_or_convulsions_numeric",
         "phh.migraines_numeric",
         "phh.multiple_sclerosis_numeric",
         "phh.parkinsons_disease_numeric",
         "phh.severe_memory_loss__numeric",
         "phh.hay_fever_numeric"	,
         "phh.drug_allergy_numeric"	,
         "phh.food_allergy__numeric"	,
         "phh.any_other_allergy__numeric"	,
         "phh.dont_know_numeric"	,
         "phh.prefer_not_to_answer_numeric"	,
         "phh.none_of_the_above_numeric"	,
         "phh.osteoporosis_numeric"	,
         "phh.osteoarthritis_numeric"	,
         "phh.rheumatoid_arthritis_numeric",
         "phh.other_arthritis_numeric"	,
         "phh.none_of_the_above.1_numeric"	,
         "phh.asthma_numeric"	,
         "phh.pulmonary_fibrosis_numeric"	,
         "phh.chronic_obstructive_pulmonary_disease__numeric"	,
         "phh.cystic_fibrosis_numeric"	,
         "phh.pleural_effusion_numeric"	,
         "phh.pneumonia__numeric" ,
         "phh.pulmonary_embolus__numeric"	,
         "phh.emphysema_or_chronic_bronchitis_numeric"	,
         "phh.other_numeric"	,
         "phh.dont_know.1_numeric"	,
         "phh.prefer_not_to_say_numeric"	,
         "phh.none_of_the_above.2_numeric"	,
         "phh.heart_attackangina_numeric"	,
         "phh.high_blood_cholesterol_numeric"	,
         "phh.high_blood_pressure_numeric"	,
         "phh.atrial_fibrillation_numeric"	,
         "phh.stroke_numeric"	,
         "phh.breast_cancer_numeric",
         "phh.lung_cancer_numeric"	,
         "phh.stomach_cancer_numeric",
         "phh.colon_cancer_numeric"	,
         "phh.uterus_cancer_numeric"	,
         "phh.prostate_cancer_numeric"	,
         "phh.none_numeric"	,
         "phh.dont_know.2_numeric"	,
         "phh.prefer_not_to_say.1_numeric"	,
         "phh.psoriasis_numeric",
         "phh.vitiligo_numeric"	,
         "phh.eczema_numeric"	,
         "phh.thyroid_disease_numeric"	,
         "phh.none.1_numeric"	,
         "phh.dont_know.3_numeric"	,
         "phh.prefer_not_to_say.2_numeric" ,
         "phh.crohns_disease_numeric"	,
         "phh.ulcerative_colitis_numeric"	,
         "phh.irritable_bowel_disease__numeric"	,
         "phh.coeliac_disease_numeric"	,
         "phh.bacterial_stomach_infection__numeric"	,
         "phh.viral_weeks_bacterial_stomach_numeric"	,
         "phh.diabetes_type_1__numeric"	,
         "phh.diabetes_type_2__numeric"	,
         "phh.pain_due_to_diabetes__numeric"	,
         "phh.prefer_not_to_answer.20_numeric"
    )
variables_numeric_0_1
```

```{r imp_check numeric variables}
imp_check(data = dat,
          variables = variables_numeric_0_1,
          values = values_numeric_0_1)
#There are no implausible values in the dataset. Can leave these variables as they are.
```


#Creating single Nervous System Illness question  - Edit when natural language extraction is fixed
```{r creating single Nervous system illness question}
dat <- dat %>%
  mutate(
    phh.nervous_system_illness_numeric =
      case_when(
        #None of the above _numeric == "1" ~ 0,
        phh.epilepsy_or_convulsions_numeric =="1" ~ 1,
        phh.migraines_numeric  =="1" ~ 2,
        phh.multiple_sclerosis_numeric =="1" ~ 3,
        phh.parkinsons_disease_numeric =="1" ~ 4,
        #Brain tumor == "1"~ 5,
        phh.severe_memory_loss__numeric  =="1" ~ 6 
        #Cerebral Palsy _numeric == "1" ~ 7,
        #dont know _numeric == "1" ~ -888,
        #Prefer not to answer == "1" ~ -999
        )
    )

#recode the numeric version into a factor
dat <- dat %>%
  mutate(
    phh.nervous_system_illness =
      recode_factor(
        phh.nervous_system_illness_numeric,
        `0` = "None of the above" , 
        `1` = "Epilepsy or convulsions",
        `2` = "Migraines",
        `3` = "Multiple sclerosis" ,
        `4` = "Parkinson's disease" ,
        `5` = "Brain Tumour",
        `6` = "Severe memory loss (like Alzheimer's)" ,
        `7` = "Cerebral Palsy",
        `-888` = "Don't know",
        `-999` = "Prefer not to say"
        )
    )

dat %>%
  freq(phh.nervous_system_illness_numeric)

dat %>%
  freq(phh.nervous_system_illness)

#++CMM Please note that Brain Tumour (5), Cerebral Palsy (7), Dont know (-888), Prefer not to answer (-999), and None of the above (0) is not included but needs to be added once natural language extraction is fixed for this
#++CMM these are the following variables in the data dictionary: phh.click_to_write_choice_9 (Brain tumour), phh.click_to_write_choice_10 (Cerebral palsy), phh.click_to_write_choice_8 (Don't know), phh.click_to_write_choice_9.1 (Prefer not to say), phh.click_to_write_choice_10.1 (None of the above)
```


#Creating single Allergies question 
```{r Creating single allergies question}
dat <- dat %>%
  mutate(
    phh.allergies_numeric =
      case_when(
        phh.none_of_the_above_numeric == "1" ~ 0,
        phh.hay_fever_numeric	== "1" ~ 1,
        phh.drug_allergy_numeric == "1" ~ 2,
        phh.food_allergy__numeric	== "1" ~ 3,
        phh.any_other_allergy__numeric == "1" ~ 4,
        phh.dont_know_numeric == "1" ~ -888,
        phh.prefer_not_to_answer_numeric == "1" ~ -999
        )
    )

#recode the numeric version into a factor
dat <- dat %>%
  mutate(
    phh.allergies =
      recode_factor(
        phh.allergies_numeric,
        `0` = "None of the above" ,
        `1` = "Hay fever",
        `2` = "Drug allergy",
        `3` = "Food allergy",
        `4` = "Any other allergy",
        `-888` = "Don't know",
        `-999` = "Prefer not to answer"
        )
    )

dat %>%
  freq(phh.allergies_numeric)

dat %>%
  freq(phh.allergies)
```


#Creating single Bone or Joint Illness question  - Edit when natural language extraction is fixed
```{r Creating Bone or Joing Illness question}
dat <- dat %>%
  mutate(
    phh.bone_or_joint_illness_numeric =
      case_when(
        phh.none_of_the_above.1_numeric =="1" ~ 0,
        #Ankylosing spondylitis _numeric == "1" ~ 1,
        phh.osteoporosis_numeric == "1" ~ 2,
        #Hyper-mobility (Ehlers-Danlos Syndrome) _numeric == "1" ~ 3,
        phh.osteoarthritis_numeric == "1" ~ 4,
        phh.rheumatoid_arthritis_numeric == "1" ~ 5,
        phh.other_arthritis_numeric == "1" ~ 6
        #phh.prefer_not_to_answer.1_numeric == "1" ~ -999,
        #Dont know _numeric == "1" ~ -888
        )
    )

#recode the numeric version into a factor
dat <- dat %>%
  mutate(
    phh.bone_or_joint_illness =
      recode_factor(
        phh.bone_or_joint_illness_numeric,
        `0` = "None of the above" ,
        `1` = "Ankylosing spondylitis",
        `2` = "Osteoporosis",
        `3` = "Hyper-mobility (Ehlers-Danlos Syndrome)",
        `4` = "Osteoarthritis",
        `5` = "Rheumatoid arthritis",
        `6` = "Other arthritis",
        `-999` = "Prefer not to answer",
        `-888` = "Dont'know"
        )
    )

dat %>%
  freq(phh.bone_or_joint_illness_numeric)

dat %>%
  freq(phh.bone_or_joint_illness)

#++CMM Please note that Ankylosing spondylitis (1),  Hyper-mobility (Ehlers-Danlos Syndrome) (3), Prefer not to answer (-999) is not included but needs to be added once natural language extraction is fixed for this. Don't know (-888) is hidden on Qualtrics and is probably not a natural language issue. Contacted Leo and Dina to fix these issues
#++CMM these are the following variables in the data dictionary: phh.click_to_write_choice_13 (Ankylosing spondylitis), phh.click_to_write_choice_12 (Hyper-mobility (Ehlers-Danlos Syndrome)), phh.prefer_not_to_answer.1 (Prefer not to answer), phh.click_to_write_choice_9.2 (Don't know <- This is hidden on Qualtrics and is probably not a natural language issue)
```


#Creating single Lung, Breathing, or Respiratory Illness question
```{r Creating Lung, Breathing, or Respiratory Illness question}
dat <- dat %>%
  mutate(
    phh.respiratory_illness_numeric =
      case_when(
        phh.none_of_the_above.2_numeric == "1" ~ 0, 
        phh.asthma_numeric == "1" ~ 1,
        phh.pulmonary_fibrosis_numeric == "1" ~ 2,
        phh.chronic_obstructive_pulmonary_disease__numeric == "1" ~ 3,
        phh.cystic_fibrosis_numeric == "1" ~ 4,
        phh.pleural_effusion_numeric == "1" ~ 5,
        phh.pneumonia__numeric == "1" ~ 6,
        phh.pulmonary_embolus__numeric == "1" ~ 7,
        phh.emphysema_or_chronic_bronchitis_numeric == "1" ~ 8,
        phh.other_numeric == "1" ~ 9,
        phh.dont_know.1_numeric == "1" ~ -888,
        phh.prefer_not_to_say_numeric == "1" ~ -999
        )
    )


#recode the numeric version into a factor
dat <- dat %>%
  mutate(
    phh.respiratory_illness =
      recode_factor(
        phh.respiratory_illness_numeric,
        `0` = "None of the above" ,
        `1` = "Asthma",
        `2` = "Pulmonary fibrosis",
        `3` = "Chronic obstructive pulmonary disease (COPD)",
        `4` = "Cystic fibrosis",
        `5` = "Pleural effusion",
        `6` = "Pneumonia (lung infection)",
        `7` = "Pulmonary embolus (blocked lung artery)",
        `8` = "Emphysema or chronic bronchitis",
        `9` = "Other",
        `-888` = "Don't know",
        `-999` = "Prefer not to say"
        )
    )

dat %>%
  freq(phh.respiratory_illness_numeric)

dat %>%
  freq(phh.respiratory_illness)
```


#Creating single Heart or Circulation Illness question - Edit when natural language extraction is fixed
```{r Creating Heart or Circulation Illness question}
dat <- dat %>%
  mutate(
    phh.heart_or_circulation_illness_numeric =
      case_when(
        #None of the above _numeric == "1" ~ 0,
        phh.heart_attackangina_numeric == "1" ~ 1,
        phh.high_blood_cholesterol_numeric == "1" ~ 2,
        phh.high_blood_pressure_numeric == "1" ~ 3,
        phh.atrial_fibrillation_numeric == "1" ~ 4,
        phh.stroke_numeric == "1" ~ 5
        #Paroxysmal tachycardia syndrome (PoTS) _numeric =="1" ~ 6,
        #Dont know _numeric == "1" ~ -888,
        #Prefer not to say _numeric == "1" ~ -999
        )
    )


#recode the numeric version into a factor
dat <- dat %>%
  mutate(
    phh.heart_or_circulation_illness =
      recode_factor(
        phh.heart_or_circulation_illness_numeric,
        `0` = "None of the above" ,
        `1` = "Heart attack/angina",
        `2` = "High blood cholesterol",
        `3` = "High blood pressure",
        `4` = "Atrial fibrillation",
        `5` = "Stroke" ,
        `6` = "Paroxysmal tachycardia syndrome (PoTS)",
        `-888` = "Don't know",
        `-999` = "Prefer not to say"
        )
    )

dat %>%
  freq(phh.heart_or_circulation_illness_numeric)

dat %>%
  freq(phh.heart_or_circulation_illness)

#++CMM Please note that Paroxysmal tachycardia syndrome (PoTS) (6), None of the above (0), Don't know (-888), Prefer not to say (-999)(3) is not included but needs to be added once natural language extraction is fixed for this. Contacted Leo to fix these issues. 
#++CMM these are the following variables in the data dictionary: phh.click_to_write_choice_11 (Paroxysmal tachycardia syndrome (PoTS)), phh.click_to_writ_choice_7 (Don't know), phh.click_to_write_choice_8.1 (Prefer not to say), phh.click_to_write_choice_9.3 (None of the above)
```


#Creating single Digestive issues or Diabetes question  - Edit when natural language extraction is fixed
```{r Creating Digestive issues or Diabetes question}
dat <- dat %>%
  mutate(
    phh.digestive_issue_or_diabetes_numeric =
      case_when(
        #phh.none_of_the_above.24_numeric == "1" ~ 0,
        phh.crohns_disease_numeric == "1" ~ 1,
        phh.ulcerative_colitis_numeric == "1" ~ 2,
        phh.irritable_bowel_disease__numeric == "1" ~ 3,
        phh.coeliac_disease_numeric == "1" ~ 4,
        phh.bacterial_stomach_infection__numeric == "1" ~ 5,
        phh.viral_weeks_bacterial_stomach_numeric == "1" ~ 6,
        phh.diabetes_type_1__numeric == "1" ~ 7,
        phh.diabetes_type_2__numeric == "1" ~ 8,
        phh.pain_due_to_diabetes__numeric == "1" ~ 9,
        #phh.dont_know.25_numeric == "1" ~ -888,
        phh.prefer_not_to_answer.20_numeric == "1" ~ -999
        )
    )


#recode the numeric version into a factor
dat <- dat %>%
  mutate(
    phh.digestive_issue_or_diabetes =
      recode_factor(
        phh.digestive_issue_or_diabetes_numeric,
        `0` = "None of the above" ,
        `1` = "Crohn's disease",
        `2` = "Ulcerative colitis",
        `3` = "Irritable bowel disease (IBD)",
        `4` = "Coeliac disease",
        `5` = "Bacterial stomach infection (E.coli or H pylori)",
        `6` = "A viral or bacterial stomach infection lasting more than 2 weeks",
        `7` = "Diabetes type 1 (early onset)",
        `8` = "Diabetes type 2 (late onset)",
        `9` = "Pain due to diabetes (Diabetic neuropathy)",
        `-888` = "Don't know",
        `-999` = "Prefer not to answer",
        )
    )

dat %>%
  freq(phh.digestive_issue_or_diabetes_numeric)

dat %>%
  freq(phh.digestive_issue_or_diabetes)
```


#Creating single Cancer question - Edit when natural language extraction is fixed
```{r Creating Cancer question}
dat <- dat %>%
  mutate(
    phh.cancer_numeric = 
      case_when(
        phh.none_numeric == "1" ~ 0,
        phh.breast_cancer_numeric == "1" ~ 1,
        phh.lung_cancer_numeric == "1" ~ 2,
        phh.stomach_cancer_numeric == "1" ~ 3,
        phh.colon_cancer_numeric == "1" ~ 4,
        phh.uterus_cancer_numeric == "1" ~ 5,
        phh.prostate_cancer_numeric == "1" ~ 6,
        #Bladder cancer _numeric == "1" ~ 7,
        #Bowel cancer _numeric == "1" ~ 8,
        #Rectal cancer _numeric == "1" ~ 9,
        #Lymphoma _numeric == "1" ~ 10,
        #Melanoma  _numeric == "1" ~ 11,
        #Skin cancer _numeric == "1" ~ 12,
        #Ovarian cancer _numeric == "1" ~ 13,
        phh.dont_know.2_numeric == "1" ~ -888,
        phh.prefer_not_to_say.1_numeric == "1" ~ -999
        )
    )


#recode the numeric version into a factor
dat <- dat %>%
  mutate(
    phh.cancer =
      recode_factor(
        phh.cancer_numeric,
        `0` = "None of the above" ,
        `1` = "Breast cancer",
        `2` = "Lung cancer",
        `3` = "Stomach cancer",
        `4` = "Colon cancer",
        `5` = "Uterus cancer",
        `6` = "Prostate cancer",
        `7` = "Bladder cancer",
        `8` = "Bowel cancer",
        `9` = "Rectal cancer",
        `10` = "Lymphoma",
        `11` = "Melanoma",
        `12` = "Skin cancer",
        `13` = "Ovarian cancer",
        `-888` = "Don't know",
        `-999` = "Prefer not to say"
        )
    )

dat %>%
  freq(phh.cancer_numeric)

dat %>%
  freq(phh.cancer)

#++CMM Please note that Bladder cancer (7), Bowel cancer (8), Rectal cancer (9), Lymphoma (10), Melanoma (11), Skin cancer (12), and Ovarian cancer (13) is not included but needs to be added once natural language extraction is fixed for this. Contacted Leo to fix these issues. 
#++CMM these are the following variables in the data dictionary: phh.click_to_write_choice_10.2	(Bladder cancer), phh.click_to_write_choice_11.1 (Bowel cancer), phh.click_to_write_choice_12.1 (rectal cancer), phh.click_to_write_choice_13.1 (lymphoma), phh.click_to_write_choice_14 (melanoma),  phh.click_to_write_choice_15 (skin cancer), phh.click_to_write_choice_16 (ovarian cancer)

```


#Creating single illness (chronic) question - Edit when natural language extraction is fixed
```{r Creating illness (chronic) question}
dat <- dat %>%
  mutate(
    phh.illness_numeric =
      case_when(
        phh.none.1_numeric == "1" ~ 0,
        phh.psoriasis_numeric == "1" ~ 1,
        phh.vitiligo_numeric == "1" ~ 2,
        phh.eczema_numeric == "1" ~ 3,
        phh.thyroid_disease_numeric == "1" ~ 4,
        #Pain due to virus (Post herpetic neuralgia) _numeric == "1" ~ 5, 
        phh.dont_know.3_numeric == "1" ~ -888,
        phh.prefer_not_to_say.2_numeric == "1" ~ -999
        )
    )

#recode the numeric version into a factor
dat <- dat %>%
  mutate(
    phh.illness =
      recode_factor(
        phh.illness_numeric,
        `0` = "None" ,
        `1` = "Psoriasis",
        `2` = "Vitiligo",
        `3` = "Eczema",
        `4` = "Thyroid disease",
        `5` = "Pain due to virus (Post herpetic neuralgia)",
        `-888` = "Don't know",
        `-999` = "Prefer not to say",
        )
    )

dat %>%
  freq(phh.illness_numeric)

dat %>%
  freq(phh.illness)

#++CMM Please note that Pain due to virus (Post herpetic neuralgia) (5) is not included but needs to be added once natural language extraction is fixed for this. Contacted Leo to fix these issues. 
#++CMM these are the following variables in the data dictionary: phh.click_to_write_choice_8.2 (Pain due to virus (Post herpetic neuralgia))
```


# Save cleaned data
## Export variables

```{r Export variables}
export_variables <- c(
    "phh.epilepsy_or_convulsions_numeric",
    "phh.epilepsy_or_convulsions",
         "phh.migraines_numeric",
         "phh.migraines",
         "phh.multiple_sclerosis_numeric",
         "phh.multiple_sclerosis",
         "phh.parkinsons_disease_numeric",
         "phh.parkinsons_disease",
         "phh.severe_memory_loss__numeric",
         "phh.severe_memory_loss_",
         "phh.hay_fever_numeric"	,
         "phh.hay_fever",
         "phh.drug_allergy_numeric"	,
         "phh.drug_allergy",
         "phh.food_allergy__numeric"	,
         "phh.food_allergy_"	,
         "phh.any_other_allergy__numeric"	,
         "phh.any_other_allergy_"	,
         "phh.dont_know_numeric"	,
         "phh.dont_know"	,
         "phh.prefer_not_to_answer_numeric"	,
         "phh.prefer_not_to_answer"	,
         "phh.none_of_the_above_numeric"	,
         "phh.none_of_the_above"	,
         "phh.osteoporosis_numeric"	,
         "phh.osteoporosis"	,
         "phh.osteoarthritis_numeric"	,
         "phh.osteoarthritis"	,
         "phh.rheumatoid_arthritis_numeric",
         "phh.rheumatoid_arthritis",
         "phh.other_arthritis_numeric"	,
         "phh.other_arthritis",
         "phh.none_of_the_above.1_numeric"	,
         "phh.none_of_the_above.1"	,
         "phh.asthma_numeric"	,
         "phh.asthma"	,
         "phh.pulmonary_fibrosis_numeric"	,
         "phh.pulmonary_fibrosis"	,
         "phh.chronic_obstructive_pulmonary_disease__numeric"	,
         "phh.chronic_obstructive_pulmonary_disease_"	,
         "phh.cystic_fibrosis_numeric"	,
         "phh.cystic_fibrosis"	,
         "phh.pleural_effusion_numeric"	,
         "phh.pleural_effusion"	,
         "phh.pneumonia__numeric" ,
         "phh.pneumonia_" ,
         "phh.pulmonary_embolus__numeric"	,
         "phh.pulmonary_embolus_"	,
         "phh.emphysema_or_chronic_bronchitis_numeric"	,
         "phh.emphysema_or_chronic_bronchitis"	,
         "phh.other_numeric"	,
         "phh.other"	,
         "phh.dont_know.1_numeric"	,
         "phh.dont_know.1"	,
         "phh.prefer_not_to_say_numeric"	,
         "phh.prefer_not_to_say"	,
         "phh.none_of_the_above.2_numeric"	,
         "phh.none_of_the_above.2"	,
         "phh.heart_attackangina_numeric"	,
         "phh.heart_attackangina"	,
         "phh.high_blood_cholesterol_numeric"	,
         "phh.high_blood_cholesterol"	,
         "phh.high_blood_pressure_numeric"	,
         "phh.high_blood_pressure"	,
         "phh.atrial_fibrillation_numeric"	,
         "phh.atrial_fibrillation"	,
         "phh.stroke_numeric"	,
         "phh.stroke"	,
         "phh.breast_cancer_numeric",
         "phh.breast_cancer",
         "phh.lung_cancer_numeric"	,
         "phh.lung_cancer"	,
         "phh.stomach_cancer_numeric",
         "phh.stomach_cancer",
         "phh.colon_cancer_numeric"	,
         "phh.colon_cancer"	,
         "phh.uterus_cancer_numeric"	,
         "phh.uterus_cancer"	,
         "phh.prostate_cancer_numeric"	,
         "phh.prostate_cancer"	,
         "phh.none_numeric"	,
         "phh.none"	,
         "phh.dont_know.2_numeric"	,
         "phh.dont_know.2"	,
         "phh.prefer_not_to_say.1_numeric"	,
         "phh.prefer_not_to_say.1"	,
         "phh.psoriasis_numeric",
         "phh.psoriasis",
         "phh.vitiligo_numeric"	,
         "phh.vitiligo"	,
         "phh.eczema_numeric"	,
         "phh.eczema"	,
         "phh.thyroid_disease_numeric"	,
         "phh.thyroid_disease"	,
         "phh.none.1_numeric"	,
         "phh.none.1"	,
         "phh.dont_know.3_numeric"	,
         "phh.dont_know.3"	,
         "phh.prefer_not_to_say.2_numeric" ,
         "phh.prefer_not_to_say.2" ,
         "phh.crohns_disease_numeric"	,
         "phh.crohns_disease"	,
         "phh.ulcerative_colitis_numeric"	,
         "phh.ulcerative_colitis"	,
         "phh.irritable_bowel_disease__numeric"	,
         "phh.irritable_bowel_disease_"	,
         "phh.coeliac_disease_numeric"	,
         "phh.coeliac_disease"	,
         "phh.bacterial_stomach_infection__numeric"	,
         "phh.bacterial_stomach_infection_"	,
         "phh.viral_weeks_bacterial_stomach_numeric"	,
         "phh.viral_weeks_bacterial_stomach"	,
         "phh.diabetes_type_1__numeric"	,
         "phh.diabetes_type_1_"	,
         "phh.diabetes_type_2__numeric"	,
         "phh.diabetes_type_2_"	,
         "phh.pain_due_to_diabetes__numeric"	,
         "phh.pain_due_to_diabetes_"	,
         "phh.prefer_not_to_answer.20_numeric",
         "phh.prefer_not_to_answer.20",
         "phh.nervous_system_illness_numeric",
         "phh.nervous_system_illness",
         "phh.allergies_numeric",
         "phh.allergies",
         "phh.bone_or_joint_illness_numeric",
         "phh.bone_or_joint_illness",
         "phh.respiratory_illness_numeric",
         "phh.respiratory_illness",
         "phh.heart_or_circulation_illness_numeric",
         "phh.heart_or_circulation_illness",
         "phh.digestive_issue_or_diabetes_numeric",
         "phh.digestive_issue_or_diabetes",
         "phh.cancer_numeric",
         "phh.cancer",
         "phh.illness_numeric",
         "phh.illness"
         )
```

```{r Save clean data as a .rds file}
dat %>% 
  select(all_of(export_variables)) %>% 
  saveRDS(file = 
            paste0(ilovedata, "/data/latest_freeze/covidcns/past_medical_history_physical_health_covidcns_clean.rds"))
```