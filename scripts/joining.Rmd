---
title: "Joining script"
author: "Christopher Huebel"
date: "20/02/2022"
output: html_document
---

This R markdown:
1) Joins COVID-CNS questionnaires together
2) Creates on rds file with matching variables
3) One rds file for the biomarker work
4) One rds file for Greta's work

# Set up

Configure global options for all chunks
```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )
```

Clear global environment prior to initiation
```{r Clear global environment}
remove(list = ls())
```

Add the add_numeric function - used to convert character variables into numeric variables
Add the remove_duplicates function - used to deduplicate and remove NAs from IDs
Add the sumscores function - used to generate sumscores
Add the package_check function - used to install and load dependencies
Add the imp_check function - used to check variables for implausible values
```{r Read in functions}
source(file = "functions/add_numeric.R")
source(file = "functions/remove_duplicates.R")
source(file = "functions/sumscores.R")
source(file = "functions/package_check.R")
source(file = "functions/imp_check.R")
```

Use package_check to install and load dependencies
Load tidyverse last
```{r Install load dependencies}
packages <- c(
  "summarytools",
  "sjlabelled", 
  "tidyverse"
  )

package_check(packages)
```

Retrieve the recent date
We are using the recent date to save files with paste0() as an extension to not overwrite old versions
```{r Recent date}
date = Sys.Date()
date
```

Read in file with path to ilovedata channel on Teams
Ensure that your credentials directory is correctly located
```{r Read in file with path to ilovedata channel on teams}
source(file = "credentials/paths.R")
```

Exclude these variables
```{r Exclude variables vector}
exclude_variables <-
  c(
    "sample",
    "startDate",
    "endDate"
  )
```


# Read in the data

## Assessment status

### COVID_CNS_casecontrol_clean
Read in & variable names
```{r COVID_CNS_casecontrol_clean Read in data & variable names}
COVID_CNS_casecontrol_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/assessment_status/COVID_CNS_casecontrol_clean.rds")
  )

COVID_CNS_casecontrol_clean %>%
  dim()
```

Dimensions
```{r COVID_CNS_casecontrol_clean Dimensions}
COVID_CNS_casecontrol_clean %>%
  colnames()
```

Select columns for joining
```{r COVID_CNS_casecontrol_clean Select columns for joining}
COVID_CNS_casecontrol_clean_selected <-
  COVID_CNS_casecontrol_clean

COVID_CNS_casecontrol_clean_selected %>%
  slice(1:5)
```


### COVID_CNS_neuroimaging_metadata_clean
Read in & variable names
```{r COVID_CNS_neuroimaging_metadata_clean Read in data & variable names}
COVID_CNS_neuroimaging_metadata_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/assessment_status/COVID_CNS_neuroimaging_metadata_clean.rds")
  )

COVID_CNS_neuroimaging_metadata_clean %>%
  dim()
```

Dimensions
```{r COVID_CNS_neuroimaging_metadata_clean Dimensions}
COVID_CNS_neuroimaging_metadata_clean %>%
  colnames()
```

Select columns for joining
```{r COVID_CNS_neuroimaging_metadata_clean Select columns for joining}
COVID_CNS_neuroimaging_metadata_clean_selected <-
  COVID_CNS_neuroimaging_metadata_clean

COVID_CNS_neuroimaging_metadata_clean_selected %>%
  slice(1:5)
```


## Demographics

### age_covidcns_clean
Read in & variable names
```{r age_covidcns_clean Read in data & variable names}
age_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/age_covidcns_clean.rds")
    )

age_covidcns_clean %>%
  dim()
```

Dimensions
```{r age_covidcns_clean Dimensions}
age_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r age_covidcns_clean Select columns for joining}
age_covidcns_clean_selected <-
  age_covidcns_clean %>%
  select(
    "ID",
    "dem.how_old_are_you_now.txt",
    "dem.dob_age"
  )

age_covidcns_clean_selected %>%
  slice(1:5)
```



### als_covidcns_clean
Read in & variable names
```{r als_covidcns_clean Read in data & variable names}
als_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/als_covidcns_clean.rds")
  )

als_covidcns_clean %>%
  dim()
```

Dimensions
```{r als_covidcns_clean Dimensions}
als_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r als_covidcns_clean Select columns for joining}
als_covidcns_clean_selected <-
  als_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

als_covidcns_clean_selected %>%
  slice(1:5)
```



### cage_covidcns_clean
Read in & variable names
```{r cage_covidcns_clean Read in data & variable names}
cage_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/cage_covidcns_clean.rds")
  )

cage_covidcns_clean %>%
  dim()
```

Dimensions
```{r cage_covidcns_clean Dimensions}
cage_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r cage_covidcns_clean Select columns for joining}
cage_covidcns_clean_selected <-
  cage_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

cage_covidcns_clean_selected %>%
  slice(1:5)
```


### catatonia_covidcns_clean
Read in & variable names
```{r catatonia_covidcns_clean Read in data & variable names}
catatonia_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/catatonia_covidcns_clean.rds")
  )

catatonia_covidcns_clean %>%
  dim()
```

Dimensions
```{r catatonia_covidcns_clean Dimensions}
catatonia_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r catatonia_covidcns_clean Select columns for joining}
catatonia_covidcns_clean_selected <-
  catatonia_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

catatonia_covidcns_clean_selected %>%
  slice(1:5)
```


### cfs_covidcns_clean
Read in & variable names
```{r cfs_covidcns_clean Read in data & variable names}
cfs_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/cfs_covidcns_clean.rds")
  )

cfs_covidcns_clean %>%
  dim()
```

Dimensions
```{r cfs_covidcns_clean Dimensions}
cfs_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r cfs_covidcns_clean Select columns for joining}
cfs_covidcns_clean_selected <-
  cfs_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

cfs_covidcns_clean_selected %>%
  slice(1:5)
```



### dem_covidpositive_covidcns_clean
Read in & variable names
```{r dem_covidpositive_covidcns_clean Read in data & variable names}
dem_covidpositive_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/dem_covidpositive_covidcns_clean.rds")
  )

dem_covidpositive_covidcns_clean %>%
  dim()
```

Dimensions 
```{r dem_covidpositive_covidcns_clean Dimensions}
dem_covidpositive_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r dem_covidpositive_covidcns_clean Select columns for joining}
dem_covidpositive_covidcns_clean_selected <-
  dem_covidpositive_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

dem_covidpositive_covidcns_clean_selected %>%
  slice(1:5)
```


### dem_memory_covidcns_clean
Read in & variable names
```{r dem_memory_covidcns_clean Read in data & variable names}
dem_memory_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/dem_memory_covidcns_clean.rds")
  )

dem_memory_covidcns_clean %>%
  dim()
```

Dimensions
```{r dem_memory_covidcns_clean Dimensions}
dem_memory_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r dem_memory_covidcns_clean Select columns for joining}
dem_memory_covidcns_clean_selected <-
  dem_memory_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

dem_memory_covidcns_clean_selected %>%
  slice(1:5)
```


### dem_quality_life_covidcns_clean
Read in & variable names
```{r dem_quality_life_covidcns_clean Read in data & variable names}
dem_quality_life_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/dem_quality_life_covidcns_clean.rds")
  )

dem_quality_life_covidcns_clean %>%
  dim()
```

Dimensions
```{r dem_quality_life_covidcns_clean Dimensions}
dem_quality_life_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r dem_quality_life_covidcns_clean Select columns for joining}
dem_quality_life_covidcns_clean_selected <-
  dem_quality_life_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

dem_quality_life_covidcns_clean_selected %>%
  slice(1:5)
```


### dem_visionhearing_covidcns_clean
Read in & variable names
```{r dem_visionhearing_covidcns_clean Read in data & variable names}
dem_visionhearing_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/dem_visionhearing_covidcns_clean.rds")
  )

dem_visionhearing_covidcns_clean %>%
  dim()
```

Dimensions
```{r dem_visionhearing_covidcns_clean Dimensions}
dem_visionhearing_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r dem_visionhearing_covidcns_clean Select columns for joining}
dem_visionhearing_covidcns_clean_selected <-
  dem_visionhearing_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

dem_visionhearing_covidcns_clean_selected %>%
  slice(1:5)
```


### impact_covidcns_clean
Read in & variable names
```{r impact_covidcns_clean Read in data & variable names}
impact_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/impact_covidcns_clean.rds")
  )

impact_covidcns_clean %>%
  dim()
```

Dimensions
```{r impact_covidcns_clean Dimensions}
impact_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r impact_covidcns_clean Select columns for joining}
impact_covidcns_clean_selected <-
  impact_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

impact_covidcns_clean_selected %>%
  slice(1:5)
```


### dem_ethnicity_covidcns_clean
Read in & variable names
```{r dem_ethnicity_covidcns_clean Read in data & variable names}
dem_ethnicity_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/dem_ethnicity_covidcns_clean.rds")
  )

dem_ethnicity_covidcns_clean %>%
  dim()
```

Dimensions
```{r dem_ethnicity_covidcns_clean Dimensions}
dem_ethnicity_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r dem_ethnicity_covidcns_clean Select columns for joining}
dem_ethnicity_covidcns_clean_selected <-
  dem_ethnicity_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

dem_ethnicity_covidcns_clean_selected %>%
  slice(1:5)
```


### facial_covidcns_clean
Read in & variable names
```{r facial_covidcns_clean Read in data & variable names}
facial_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/facial_covidcns_clean.rds")
  )

facial_covidcns_clean %>%
  dim()
```

Dimensions
```{r facial_covidcns_clean Dimensions}
facial_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r facial_covidcns_clean Select columns for joining}
facial_covidcns_clean_selected <-
  facial_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

facial_covidcns_clean_selected %>%
  slice(1:5)
```


### gad7_covidcns_clean
Read in & variable names
```{r gad7_covidcns_clean Read in data & variable names}
gad7_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/gad7_covidcns_clean.rds")
  )

gad7_covidcns_clean %>%
  dim()
```

Dimensions
```{r gad7_covidcns_clean Dimensions}
gad7_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r gad7_covidcns_clean Select columns for joining}
gad7_covidcns_clean_selected <- gad7_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

gad7_covidcns_clean_selected %>%
  slice(1:5)
```


### dem_highest_qualification_covidcns_clean
Read in & variable names
```{r dem_highest_qualification_covidcns_clean Read in data & variable names}
dem_highest_qualification_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/dem_highest_qualification_covidcns_clean.rds")
  )

dem_highest_qualification_covidcns_clean %>%
  dim()
```

Dimensions
```{r dem_highest_qualification_covidcns_clean Dimensions}
dem_highest_qualification_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r dem_highest_qualification_covidcns_clean Select columns for joining}
dem_highest_qualification_covidcns_clean_selected <- dem_highest_qualification_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

dem_highest_qualification_covidcns_clean_selected %>%
  slice(1:5)
```


### dem_language_covidcns_clean
Read in & variable names
```{r dem_language_covidcns_clean Read in data & variable names}
dem_language_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/dem_language_covidcns_clean.rds")
  )

dem_language_covidcns_clean %>%
  dim()
```

Dimensions
```{r dem_language_covidcns_clean Dimensions}
dem_language_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r dem_language_covidcns_clean Select columns for joining}
dem_language_covidcns_clean_selected <- dem_language_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

dem_language_covidcns_clean_selected %>%
  slice(1:5)
```

### nis_outp_covidcns_clean
Read in & variable names
```{r nis_outp_covidcns_clean Read in data & variable names}
nis_outp_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/core_neuro/nis_outp_covidcns_clean.rds")
  )

nis_outp_covidcns_clean %>%
  dim()
```

Dimensions
```{r nis_outp_covidcns_clean Dimensions}
nis_outp_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r nis_outp_covidcns_clean Select columns for joining}
nis_outp_covidcns_clean_selected <-
  nis_outp_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

nis_outp_covidcns_clean_selected %>%
  slice(1:5)
```


### nonmotor_covidcns_clean
Read in & variable names
```{r nonmotor_covidcns_clean Read in data & variable names}
nonmotor_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/nonmotor_covidcns_clean.rds")
  )

nonmotor_covidcns_clean %>%
  dim()
```

Dimensions
```{r nonmotor_covidcns_clean Dimensions}
nonmotor_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r nonmotor_covidcns_clean Select columns for joining}
nonmotor_covidcns_clean_selected <-
  nonmotor_covidcns_clean %>%
  select(
    "ID",
    "sample",
    "startDate"
  )

nonmotor_covidcns_clean_selected %>%
  slice(1:5)
```




### past_medical_history_mental_health_covidcns_clean
Read in & variable names

Had this name before: past_medical_history_mental_health_covidcns_clean.rds
```{r past_medical_history_mental_health_covidcns_clean Read in data & variable names}
past_medical_history_mental_health_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/PHH_forgreta_covidcns_clean.rds")
  )


past_medical_history_mental_health_covidcns_clean %>%
  dim()
```

Dimensions
```{r past_medical_history_mental_health_covidcns_clean Dimensions}
past_medical_history_mental_health_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r past_medical_history_mental_health_covidcns_clean Select columns for joining}
past_medical_history_mental_health_covidcns_clean_selected <- past_medical_history_mental_health_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

past_medical_history_mental_health_covidcns_clean_selected %>%
  slice(1:5)
```


### past_medical_history_physical_health_covidcns_clean
Read in & variable names
```{r past_medical_history_physical_health_covidcns_clean Read in data & variable names}
past_medical_history_physical_health_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/past_medical_history_physical_health_covidcns_clean.rds")
  )

past_medical_history_physical_health_covidcns_clean %>%
  dim()
```

Dimensions
```{r past_medical_history_physical_health_covidcns_clean Dimensions}
past_medical_history_physical_health_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r past_medical_history_physical_health_covidcns_clean Select columns for joining}
past_medical_history_physical_health_covidcns_clean_selected <- past_medical_history_physical_health_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

past_medical_history_physical_health_covidcns_clean_selected %>%
  slice(1:5)
```


### pcl5_covidcns_clean
Read in & variable names
```{r pcl5_covidcns_clean Read in data & variable names}
pcl5_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/pcl5_covidcns_clean.rds")
  )

pcl5_covidcns_clean %>%
  dim()
```

Dimensions
```{r pcl5_covidcns_clean Dimensions}
pcl5_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r pcl5_covidcns_clean Select columns for joining}
pcl5_covidcns_clean_selected <-
  pcl5_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

pcl5_covidcns_clean_selected %>%
  slice(1:5)
```



### phq9_covidcns_clean
Read in & variable names
```{r phq9_covidcns_clean Read in data & variable names}
phq9_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/phq9_covidcns_clean.rds")
  )

phq9_covidcns_clean %>%
  dim()
```

Dimensions
```{r phq9_covidcns_clean Dimensions}
phq9_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r phq9_covidcns_clean Select columns for joining}
phq9_covidcns_clean_selected <- phq9_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )


phq9_covidcns_clean_selected %>%
  slice(1:5)
```


### dem_sex_gender_sexuality_covidcns_clean
Read in & variable names
```{r dem_sex_gender_sexuality_covidcns_clean Read in data & variable names}
dem_sex_gender_sexuality_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/dem_sex_gender_sexuality_covidcns_clean.rds")
  )

dem_sex_gender_sexuality_covidcns_clean %>%
  dim()
```

Dimensions
```{r dem_sex_gender_sexuality_covidcns_clean Dimensions}
dem_sex_gender_sexuality_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r dem_sex_gender_sexuality_covidcns_clean Select columns for joining}
dem_sex_gender_sexuality_covidcns_clean_selected <-
  dem_sex_gender_sexuality_covidcns_clean %>%
  select(
    -c(
    "sample",
    "startDate",
    "endDate...4") # that's odd
  )

dem_sex_gender_sexuality_covidcns_clean_selected %>%
  slice(1:5)
```


### smelltaste_covidcns_clean
Read in & variable names
```{r smelltaste_covidcns_clean Read in data & variable names}
smelltaste_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/smelltaste_covidcns_clean.rds")
  )

smelltaste_covidcns_clean %>%
  dim()
```

Dimensions
```{r smelltaste_covidcns_clean Dimensions}
smelltaste_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r smelltaste_covidcns_clean Select columns for joining}
smelltaste_covidcns_clean_selected <- smelltaste_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

smelltaste_covidcns_clean_selected %>%
  slice(1:5)
```


### trauma_covidcns_clean
Read in & variable names
```{r trauma_covidcns_clean Read in data & variable names}
trauma_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/trauma_covidcns_clean.rds")
  )

trauma_covidcns_clean %>%
  dim()
```

Dimensions
```{r trauma_covidcns_clean Dimensions}
trauma_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r trauma_covidcns_clean Select columns for joining}
trauma_covidcns_clean_selected <-
  trauma_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

trauma_covidcns_clean_selected %>%
  slice(1:5)
```

### updrs_covidcns_clean
Read in & variable names
```{r updrs_covidcns_clean Read in data & variable names}
updrs_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/updrs_covidcns_clean.rds")
  )

updrs_covidcns_clean %>%
  dim()
```

Dimensions
```{r updrs_covidcns_clean Dimensions}
updrs_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r updrs_covidcns_clean Select columns for joining}
updrs_covidcns_clean_selected <-
  updrs_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

updrs_covidcns_clean_selected %>%
  slice(1:5)
```


### vaccine_covidcns_clean
Read in & variable names
```{r vaccine_covidcns_clean Read in data & variable names}
vaccine_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/baseline/vaccine_covidcns_clean.rds")
  )

vaccine_covidcns_clean %>%
  dim()
```

Dimensions
```{r vaccine_covidcns_clean Dimensions}
vaccine_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r vaccine_covidcns_clean Select columns for joining}
vaccine_covidcns_clean_selected <- vaccine_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

vaccine_covidcns_clean_selected %>%
  slice(1:5)
```


## Core Neuro

### fourat_outp_covidcns_clean
Read in & variable names
```{r fourat_outp_covidcns_clean Read in data & variable names}
fourat_outp_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/core_neuro/fourat_outp_covidcns_clean.rds")
  )

fourat_outp_covidcns_clean %>%
  dim()
```

Dimensions
```{r fourat_outp_covidcns_clean Dimensions}
fourat_outp_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r fourat_outp_covidcns_clean Select columns for joining}
fourat_outp_covidcns_clean_selected <-
  fourat_outp_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

fourat_outp_covidcns_clean_selected %>%
  slice(1:5)
```


## mh_case_report

### moca_inp_covidcns_clean
Read in & variable names
```{r moca_inp_covidcns_clean Read in data & variable names}
moca_inp_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/mh_case_report/moca_inp_covidcns_clean.rds")
  )

moca_inp_covidcns_clean %>%
  dim()
```

Dimensions
```{r moca_inp_covidcns_clean Dimensions}
moca_inp_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r moca_inp_covidcns_clean Select columns for joining}
moca_inp_covidcns_clean_selected <-
  moca_inp_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

moca_inp_covidcns_clean_selected %>%
  slice(1:5)
```


## moca

### cognitron_outp_covidcns_clean
Read in & variable names
```{r cognitron_outp_covidcns_clean Read in data & variable names}
cognitron_outp_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/moca/cognitron_outp_covidcns_clean.rds")
  )

cognitron_outp_covidcns_clean %>%
  dim()
```

Dimensions
```{r cognitron_outp_covidcns_clean Dimensions}
cognitron_outp_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r cognitron_outp_covidcns_clean Select columns for joining}
cognitron_outp_covidcns_clean_selected <-
  cognitron_outp_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

cognitron_outp_covidcns_clean_selected %>%
  slice(1:5)
```


### moca_outp_covidcns_clean
Read in & variable names
```{r moca_outp_covidcns_clean Read in data & variable names}
moca_outp_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/moca/moca_outp_covidcns_clean.rds")
  )

moca_outp_covidcns_clean %>%
  dim()
```

Dimensions
```{r moca_outp_covidcns_clean Dimensions}
moca_outp_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r moca_outp_covidcns_clean Select columns for joining}
moca_outp_covidcns_clean_selected <-
  moca_outp_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

moca_outp_covidcns_clean_selected %>%
  slice(1:5)
```


## ncrf

### ncrf_clinical_frailty_clean
Read in & variable names
```{r ncrf_clinical_frailty_clean Read in data & variable names}
ncrf_clinical_frailty_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf_clinical_frailty_clean.rds")
  )

ncrf_clinical_frailty_clean %>%
  dim()
```

Dimensions
```{r ncrf_clinical_frailty_clean Dimensions}
ncrf_clinical_frailty_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf_clinical_frailty_clean Select columns for joining}
ncrf_clinical_frailty_clean_selected <- 
  ncrf_clinical_frailty_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf_clinical_frailty_clean_selected %>%
  slice(1:5)
```


### ncrf2_med_covidcns_clean
Read in & variable names
```{r ncrf2_med_covidcns_clean Read in data & variable names}
ncrf2_med_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf2_med_covidcns_clean.rds")
  )

ncrf2_med_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf2_med_covidcns_clean Dimensions}
ncrf2_med_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf2_med_covidcns_clean Select columns for joining}
ncrf2_med_covidcns_clean_selected <-
  ncrf2_med_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf2_med_covidcns_clean_selected %>%
  slice(1:5)
```


### ncrf1_admission_covidcns_clean
Read in & variable names
```{r ncrf1_admission_covidcns_clean Read in data & variable names}
ncrf1_admission_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf1_admission_covidcns_clean.rds")
  )

ncrf1_admission_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf1_admission_covidcns_clean Dimensions}
ncrf1_admission_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf1_admission_covidcns_clean Select columns for joining}
ncrf1_admission_covidcns_clean_selected <- 
  ncrf1_admission_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf1_admission_covidcns_clean_selected %>%
  slice(1:5)
```


### ncrf1_care_covidcns_clean
Read in & variable names
```{r ncrf1_care_covidcns_clean Read in data & variable names}
ncrf1_care_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf1_care_covidcns_clean.rds")
  )

ncrf1_care_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf1_care_covidcns_clean Dimensions}
ncrf1_care_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf1_care_covidcns_clean Select columns for joining}
ncrf1_care_covidcns_clean_selected <-
  ncrf1_care_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf1_care_covidcns_clean_selected %>%
  slice(1:5)
```


### ncrf1_cic_covidcns_clean
Read in & variable names
```{r ncrf1_cic_covidcns_clean Read in data & variable names}
ncrf1_cic_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf1_cic_covidcns_clean.rds")
  )

ncrf1_cic_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf1_cic_covidcns_clean Dimensions}
ncrf1_cic_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf1_cic_covidcns_clean Select columns for joining}
ncrf1_cic_covidcns_clean_selected <-
  ncrf1_cic_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf1_cic_covidcns_clean_selected %>%
  slice(1:5)
```


### ncrf1_comorbid_covidcns_clean
Read in & variable names
```{r ncrf1_comorbid_covidcns_clean Read in data & variable names}
ncrf1_comorbid_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf1_comorbid_covidcns_clean.rds")
  )

ncrf1_comorbid_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf1_comorbid_covidcns_clean Dimensions}
ncrf1_comorbid_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf1_comorbid_covidcns_clean Select columns for joining}
ncrf1_comorbid_covidcns_clean_selected <-
  ncrf1_comorbid_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf1_comorbid_covidcns_clean_selected %>%
  slice(1:5)
```

### ncrf1_lab_covidcns_clean
Read in & variable names
```{r ncrf1_lab_covidcns_clean Read in data & variable names}
ncrf1_lab_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf1_lab_covidcns_clean.rds")
  )

ncrf1_lab_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf1_lab_covidcns_clean Dimensions}
ncrf1_lab_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf1_lab_covidcns_clean Select columns for joining}
ncrf1_lab_covidcns_clean_selected <-
  ncrf1_lab_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf1_lab_covidcns_clean_selected %>%
  slice(1:5)
```


### ncrf1_pre_med_covidcns_clean
Read in & variable names
```{r ncrf1_pre_med_covidcns_clean Read in data & variable names}
ncrf1_pre_med_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf1_pre_med_covidcns_clean.rds")
  )

ncrf1_pre_med_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf1_pre_med_covidcns_clean Dimensions}
ncrf1_pre_med_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf1_pre_med_covidcns_clean Select columns for joining}
ncrf1_pre_med_covidcns_clean_selected <-
  ncrf1_pre_med_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf1_pre_med_covidcns_clean_selected %>%
  slice(1:5)
```


### ncrf1_vital_covidcns_clean
Read in & variable names
```{r ncrf1_vital_covidcns_clean Read in data & variable names}
ncrf1_vital_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf1_vital_covidcns_clean.rds")
  )

ncrf1_vital_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf1_vital_covidcns_clean Dimensions}
ncrf1_vital_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf1_vital_covidcns_clean Select columns for joining}
ncrf1_vital_covidcns_clean_selected <-
  ncrf1_vital_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf1_vital_covidcns_clean_selected %>%
  slice(1:5)
```



  

### ncrf2_care_covidcns_clean
Read in & variable names
```{r ncrf2_care_covidcns_clean Read in data & variable names}
ncrf2_care_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf2_care_covidcns_clean.rds")
  )

ncrf2_care_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf2_care_covidcns_clean Dimensions}
ncrf2_care_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf2_care_covidcns_clean Select columns for joining}
ncrf2_care_covidcns_clean_selected <-
  ncrf2_care_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf2_care_covidcns_clean_selected %>%
  slice(1:5)
```


### ncrf2_lab_covidcns_clean
Read in & variable names
```{r ncrf2_lab_covidcns_clean Read in data & variable names}
ncrf2_lab_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf2_lab_covidcns_clean.rds")
  )

ncrf2_lab_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf2_lab_covidcns_clean Dimensions}
ncrf2_lab_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf2_lab_covidcns_clean Select columns for joining}
ncrf2_lab_covidcns_clean_selected <-
  ncrf2_lab_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf2_lab_covidcns_clean_selected %>%
  slice(1:5)
```


### ncrf2_vital_covidcns_clean
Read in & variable names
```{r ncrf2_vital_covidcns_clean Read in data & variable names}
ncrf2_vital_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf2_vital_covidcns_clean.rds")
  )

ncrf2_vital_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf2_vital_covidcns_clean Dimensions}
ncrf2_vital_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf2_vital_covidcns_clean Select columns for joining}
ncrf2_vital_covidcns_clean_selected <-
  ncrf2_vital_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf2_vital_covidcns_clean_selected %>%
  slice(1:5)
```


### ncrf3_compli_covidcns_clean
Read in & variable names
```{r ncrf3_compli_covidcns_clean Read in data & variable names}
ncrf3_compli_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf3_compli_covidcns_clean.rds")
  )

ncrf3_compli_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf3_compli_covidcns_clean Dimensions}
ncrf3_compli_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf3_compli_covidcns_clean Select columns for joining}
ncrf3_compli_covidcns_clean_selected <-
  ncrf3_compli_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf3_compli_covidcns_clean_selected %>%
  slice(1:5)
```


### ncrf3_diag_covidcns_clean
Read in & variable names
```{r ncrf3_diag_covidcns_clean Read in data & variable names}
ncrf3_diag_covidcns_clean <-
  read_rds(
    file = 
      paste0(ilovedata, "/data/latest_freeze/neuro_case_report/ncrf3_diag_covidcns_clean.rds")
  )

ncrf3_diag_covidcns_clean %>%
  dim()
```

Dimensions
```{r ncrf3_diag_covidcns_clean Dimensions}
ncrf3_diag_covidcns_clean %>%
  colnames()
```

Select columns for joining
```{r ncrf3_diag_covidcns_clean Select columns for joining}
ncrf3_diag_covidcns_clean_selected <-
  ncrf3_diag_covidcns_clean %>%
  select(
    -all_of(exclude_variables)
  )

ncrf3_diag_covidcns_clean_selected %>%
  slice(1:5)
```


# Cognitron

### cognitron
Read in & variable names
```{r cognitron Read in data & variable names}
cognitron <-
  readRDS(
    paste0(ilovedata, "/data/cognitron/scores/cognitron_scores.rds")
  )

cognitron %>%
  dim()
```

Dimensions
```{r cognitron Dimensions}
cognitron %>%
  colnames()
```

Select columns for joining
```{r cognitron Select columns for joining}
cognitron_selected <- cognitron %>%
  rename(
    "ID" = "user_id"
  )

cognitron_selected %>%
  slice(1:5)
```


## List of tibbles to join
```{r List of tibbles to join}
tibble_list <- 
  list(
    COVID_CNS_casecontrol_clean_selected,
    COVID_CNS_neuroimaging_metadata_clean_selected,
    age_covidcns_clean_selected,
    als_covidcns_clean_selected,
    cage_covidcns_clean_selected,
    catatonia_covidcns_clean_selected,
    cfs_covidcns_clean_selected,
    dem_covidpositive_covidcns_clean_selected,
    dem_memory_covidcns_clean_selected,
    dem_quality_life_covidcns_clean_selected,
    dem_visionhearing_covidcns_clean,
    impact_covidcns_clean_selected,
    dem_ethnicity_covidcns_clean_selected,
    facial_covidcns_clean_selected,
    gad7_covidcns_clean_selected,
    dem_highest_qualification_covidcns_clean_selected,
    dem_language_covidcns_clean_selected,
    nis_outp_covidcns_clean_selected,
    nonmotor_covidcns_clean_selected,
    past_medical_history_mental_health_covidcns_clean_selected,
    past_medical_history_physical_health_covidcns_clean_selected,
    pcl5_covidcns_clean_selected,
    PHH_interimtemp_covidcns_clean_selected,
    phq9_covidcns_clean_selected,
    dem_sex_gender_sexuality_covidcns_clean_selected,
    smelltaste_covidcns_clean_selected,
    trauma_covidcns_clean_selected,
    updrs_covidcns_clean_selected,
    vaccine_covidcns_clean_selected,
    # core_neuro
    fourat_outp_covidcns_clean_selected,
   # mh_case_report
    moca_inp_covidcns_clean_selected,
    # moca
    cognitron_outp_covidcns_clean_selected,
    moca_outp_covidcns_clean_selected,
    # neuro_case_report
    ncrf_clinical_frailty_clean_selected,
    ncrf2_med_covidcns_clean_selected,
    # ncrf1
    ncrf1_admission_covidcns_clean_selected,
    ncrf1_care_covidcns_clean_selected,
    ncrf1_cic_covidcns_clean_selected,
    ncrf1_comorbid_covidcns_clean_selected,
    ncrf1_lab_covidcns_clean_selected,
    ncrf1_pre_med_covidcns_clean_selected,
    ncrf1_vital_covidcns_clean_selected,
    # ncrf2
    ncrf2_care_covidcns_clean_selected,
    ncrf2_lab_covidcns_clean_selected,
    ncrf2_vital_covidcns_clean_selected,
    # ncrf3    
    ncrf3_compli_covidcns_clean_selected,
    ncrf3_diag_covidcns_clean_selected
    )
```

Joining of demographics and questionnaires
```{r Joining of demographics and questionnaires}
data_joined <- 
  plyr::join_all(
    tibble_list,
    by = c(
      "ID"
      )
    )
```

Check dimensions of joined tibble
```{r Check dimensions of joined tibble}
data_joined %>%
  dim()
```

Check for duplicated columns
+++CH: Does duplicated work here?
```{r Check for duplicated columns}
data_joined %>%
  colnames() %>%
  duplicated()
```

```{r}
colnames(data_joined[duplicated(as.list(data_joined))])
```




```{r}
data_joined %>% 
  colnames()
```



Select columns for data extraction
```{r matching Select columns}
data_export_matching <- data_joined %>%
  select(
      "ID",
      
      # Age
      "dem.dob_age",
      "dem.how_old_are_you_now.txt",
      
      # Gender
      "dem.what_gender_do_you_identify_with",
      "dem.what_gender_do_you_identify_with_numeric",
      
      # Language
      "dem.is_english_your_first_language",
      "dem.what_is_your_first_language.txt",
      "dem.what_is_your_first_language_numeric",
      "dem.is_english_your_first_language_numeric",
      
      # Education
      "dem.highest_education",
      "dem.highest_education_numeric",
      
      # impact
      "impact.fulltime_employed",
      "impact.unemployed",
      "impact.stayathome_parent_or_carer",
      "impact.contract_or_freelance_work",
      "impact.receiving_state_income",
      "impact.student_",
      "impact.prefer_not_to_say",
      "impact.parttime_employed",
      "impact.zerohours_contract",
      "impact.selfemployed",
      "impact.small_buisness_owner",
      "impact.retired",
      "impact.student_.1"
      )


data_export_matching %>%
  slice(1:5)
```

# Save joined data set
```{r matching Save joint data set}
saveRDS(
  object = data_export_matching, 
  file = paste0(ilovedata, "/data/joined/covidcns_matching.rds")
)
```


Select columns for data extraction
```{r greta Select columns}
data_export_greta <- data_joined #%>%
#  select(
#    
#  )
```

# Save joined data set
```{r greta Save joint data set}
saveRDS(
  object = data_export_greta, 
  file = paste0(ilovedata, "/data/joined/covidcns_greta.rds")
)
```



Select columns for data extraction
```{r yun Select columns}
data_export_yun <- data_joined %>%
  select(
    
  )
```

# Save joined data set
```{r yun Save joint data set}
saveRDS(
  object = data_export_yun, 
  file = paste0(ilovedata, "/data/joined/covidcns_yun.rds")
)
```


